
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>pystellibs.simpletable &#8212; pystellibs 1.0 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pystellibs.simpletable</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot; This file implements a Table class</span>
<span class="sd">    that is designed to be the basis of any format</span>

<span class="sd">Requirements</span>
<span class="sd">------------</span>

<span class="sd">* FIT format:</span>
<span class="sd">    * astropy:</span>
<span class="sd">        provides a replacement to pyfits</span>
<span class="sd">        pyfits can still be used instead but astropy is now the default</span>

<span class="sd">* HDF5 format:</span>
<span class="sd">    * pytables</span>

<span class="sd">RuntimeError will be raised when writing to a format associated with missing</span>
<span class="sd">package.</span>


<span class="sd">.. code-block::python</span>

<span class="sd">    &gt;&gt;&gt; t = SimpleTable(&#39;path/mytable.csv&#39;)</span>
<span class="sd">    # get a subset of columns only</span>
<span class="sd">    &gt;&gt;&gt; s = t.get(&#39;M_* logTe logLo U B V I J K&#39;)</span>
<span class="sd">    # set some aliases</span>
<span class="sd">    &gt;&gt;&gt; t.set_alias(&#39;logT&#39;, &#39;logTe&#39;)</span>
<span class="sd">    &gt;&gt;&gt; t.set_alias(&#39;logL&#39;, &#39;logLLo&#39;)</span>
<span class="sd">    # make a query on one or multiple column</span>
<span class="sd">    &gt;&gt;&gt; q = s.selectWhere(&#39;logT logL&#39;, &#39;(J &gt; 2) &amp; (10 ** logT &gt; 5000)&#39;)</span>
<span class="sd">    # q is also a table object</span>
<span class="sd">    &gt;&gt;&gt; q.plot(&#39;logT&#39;, &#39;logL&#39;, &#39;,&#39;)</span>
<span class="sd">    # makes a simple plot</span>
<span class="sd">    &gt;&gt;&gt; s.write(&#39;newtable.fits&#39;)</span>
<span class="sd">    # export the initial subtable to a new file</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="p">(</span><span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">)</span>

<span class="n">__version__</span> <span class="o">=</span> <span class="s1">&#39;3.0&#39;</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;AstroHelpers&#39;</span><span class="p">,</span> <span class="s1">&#39;AstroTable&#39;</span><span class="p">,</span> <span class="s1">&#39;SimpleTable&#39;</span><span class="p">,</span> <span class="s1">&#39;stats&#39;</span><span class="p">]</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">deepcopy</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">wraps</span><span class="p">,</span> <span class="n">partial</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="k">import</span> <span class="n">deg2rad</span><span class="p">,</span> <span class="n">rad2deg</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">arcsin</span><span class="p">,</span> <span class="n">arctan2</span>
<span class="kn">from</span> <span class="nn">numpy.lib</span> <span class="k">import</span> <span class="n">recfunctions</span>
<span class="kn">import</span> <span class="nn">types</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">astropy.io</span> <span class="k">import</span> <span class="n">fits</span> <span class="k">as</span> <span class="n">pyfits</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pyfits</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">pyfits</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">tables</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">_pd</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">_pd</span> <span class="o">=</span> <span class="kc">None</span>


<span class="c1"># ==============================================================================</span>
<span class="c1"># Python 3 compatibility behavior</span>
<span class="c1"># ==============================================================================</span>
<span class="c1"># remap some python 2 built-ins on to py3k behavior or equivalent</span>
<span class="c1"># Most of them become generators</span>
<span class="kn">import</span> <span class="nn">operator</span>

<span class="n">PY3</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span>

<span class="k">if</span> <span class="n">PY3</span><span class="p">:</span>
    <span class="n">iteritems</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">methodcaller</span><span class="p">(</span><span class="s1">&#39;items&#39;</span><span class="p">)</span>
    <span class="n">itervalues</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">methodcaller</span><span class="p">(</span><span class="s1">&#39;values&#39;</span><span class="p">)</span>
    <span class="n">basestring</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">range</span> <span class="o">=</span> <span class="n">xrange</span>
    <span class="kn">from</span> <span class="nn">itertools</span> <span class="k">import</span> <span class="n">izip</span> <span class="k">as</span> <span class="nb">zip</span>
    <span class="n">iteritems</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">methodcaller</span><span class="p">(</span><span class="s1">&#39;iteritems&#39;</span><span class="p">)</span>
    <span class="n">itervalues</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">methodcaller</span><span class="p">(</span><span class="s1">&#39;itervalues&#39;</span><span class="p">)</span>
    <span class="n">basestring</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">unicode</span><span class="p">)</span>


<span class="c1"># ==============================================================================</span>
<span class="c1"># Specials -- special functions</span>
<span class="c1"># ==============================================================================</span>

<span class="k">def</span> <span class="nf">pretty_size_print</span><span class="p">(</span><span class="n">num_bytes</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Output number of bytes in a human readable format</span>

<span class="sd">    keywords</span>
<span class="sd">    --------</span>
<span class="sd">    num_bytes: int</span>
<span class="sd">        number of bytes to convert</span>

<span class="sd">    returns</span>
<span class="sd">    -------</span>
<span class="sd">    output: str</span>
<span class="sd">        string representation of the size with appropriate unit scale</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">num_bytes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">KiB</span> <span class="o">=</span> <span class="mi">1024</span>
    <span class="n">MiB</span> <span class="o">=</span> <span class="n">KiB</span> <span class="o">*</span> <span class="n">KiB</span>
    <span class="n">GiB</span> <span class="o">=</span> <span class="n">KiB</span> <span class="o">*</span> <span class="n">MiB</span>
    <span class="n">TiB</span> <span class="o">=</span> <span class="n">KiB</span> <span class="o">*</span> <span class="n">GiB</span>
    <span class="n">PiB</span> <span class="o">=</span> <span class="n">KiB</span> <span class="o">*</span> <span class="n">TiB</span>
    <span class="n">EiB</span> <span class="o">=</span> <span class="n">KiB</span> <span class="o">*</span> <span class="n">PiB</span>
    <span class="n">ZiB</span> <span class="o">=</span> <span class="n">KiB</span> <span class="o">*</span> <span class="n">EiB</span>
    <span class="n">YiB</span> <span class="o">=</span> <span class="n">KiB</span> <span class="o">*</span> <span class="n">ZiB</span>

    <span class="k">if</span> <span class="n">num_bytes</span> <span class="o">&gt;</span> <span class="n">YiB</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.3g</span><span class="s1"> YB&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num_bytes</span> <span class="o">/</span> <span class="n">YiB</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">num_bytes</span> <span class="o">&gt;</span> <span class="n">ZiB</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.3g</span><span class="s1"> ZB&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num_bytes</span> <span class="o">/</span> <span class="n">ZiB</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">num_bytes</span> <span class="o">&gt;</span> <span class="n">EiB</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.3g</span><span class="s1"> EB&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num_bytes</span> <span class="o">/</span> <span class="n">EiB</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">num_bytes</span> <span class="o">&gt;</span> <span class="n">PiB</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.3g</span><span class="s1"> PB&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num_bytes</span> <span class="o">/</span> <span class="n">PiB</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">num_bytes</span> <span class="o">&gt;</span> <span class="n">TiB</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.3g</span><span class="s1"> TB&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num_bytes</span> <span class="o">/</span> <span class="n">TiB</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">num_bytes</span> <span class="o">&gt;</span> <span class="n">GiB</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.3g</span><span class="s1"> GB&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num_bytes</span> <span class="o">/</span> <span class="n">GiB</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">num_bytes</span> <span class="o">&gt;</span> <span class="n">MiB</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.3g</span><span class="s1"> MB&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num_bytes</span> <span class="o">/</span> <span class="n">MiB</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">num_bytes</span> <span class="o">&gt;</span> <span class="n">KiB</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.3g</span><span class="s1"> KB&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num_bytes</span> <span class="o">/</span> <span class="n">KiB</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.3g</span><span class="s1"> Bytes&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num_bytes</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">output</span>


<span class="k">def</span> <span class="nf">_fits_read_header</span><span class="p">(</span><span class="n">hdr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert pyfits header into dictionary with relevant values</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    hdr: pyftis.Header</span>
<span class="sd">        fits unit</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    header: dict</span>
<span class="sd">        header dictionary</span>

<span class="sd">    alias: dict</span>
<span class="sd">        aliases</span>

<span class="sd">    units: dict</span>
<span class="sd">        units</span>

<span class="sd">    comments: dict</span>
<span class="sd">        comments/description of keywords</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">header</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">alias</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">units</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">comments</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># generic cards</span>
    <span class="n">genTerms</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;XTENSION&#39;</span><span class="p">,</span> <span class="s1">&#39;BITPIX&#39;</span><span class="p">,</span> <span class="s1">&#39;NAXIS&#39;</span><span class="p">,</span> <span class="s1">&#39;NAXIS1&#39;</span><span class="p">,</span>
                <span class="s1">&#39;NAXIS2&#39;</span><span class="p">,</span> <span class="s1">&#39;PCOUNT&#39;</span><span class="p">,</span> <span class="s1">&#39;GCOUNT&#39;</span><span class="p">,</span> <span class="s1">&#39;TFIELDS&#39;</span><span class="p">,</span>
                <span class="s1">&#39;EXTNAME&#39;</span><span class="p">]</span>
    <span class="n">fieldTerms</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;TTYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;TFORM&#39;</span><span class="p">,</span> <span class="s1">&#39;TUNIT&#39;</span><span class="p">,</span> <span class="s1">&#39;ALIAS&#39;</span><span class="p">]</span>

    <span class="c1"># read col comments</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">comment</span> <span class="ow">in</span> <span class="n">hdr</span><span class="o">.</span><span class="n">ascard</span><span class="p">[</span><span class="s1">&#39;TTYPE*&#39;</span><span class="p">]:</span>
        <span class="n">comments</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">comment</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">hdr</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;UNIT&#39;</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">u</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">units</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span>

    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">hdr</span><span class="o">.</span><span class="n">ascard</span><span class="p">[</span><span class="s1">&#39;ALIAS*&#39;</span><span class="p">]:</span>
        <span class="n">al</span><span class="p">,</span> <span class="n">orig</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
        <span class="n">alias</span><span class="p">[</span><span class="n">al</span><span class="p">]</span> <span class="o">=</span> <span class="n">orig</span>

    <span class="c1"># other specific keywords: COMMENT, HISTORY</span>
    <span class="n">header_comments</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">header_history</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">hdr</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">genTerms</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">k</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fieldTerms</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;COMMENT&#39;</span><span class="p">):</span>
                <span class="n">header_comments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;HISTORY&#39;</span><span class="p">):</span>
                <span class="n">header_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">header</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

    <span class="c1"># COMMENT, HISTORY polish</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">header_comments</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;COMMENT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">header_comments</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">header_history</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;HISTORY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">header_history</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;EXTNAME&#39;</span> <span class="ow">in</span> <span class="n">hdr</span><span class="p">:</span>
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hdr</span><span class="p">[</span><span class="s1">&#39;EXTNAME&#39;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">header</span><span class="p">,</span> <span class="n">alias</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">comments</span>


<span class="k">def</span> <span class="nf">_fits_generate_header</span><span class="p">(</span><span class="n">tab</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Generate the corresponding fits Header that contains all necessary info</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    tab: SimpleTable instance</span>
<span class="sd">        table</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    hdr: pyfits.Header</span>
<span class="sd">        header instance</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># get column cards</span>

    <span class="n">cards</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># names units and comments</span>
    <span class="k">for</span> <span class="n">e</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">cards</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;TTYPE</span><span class="si">{0:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">k</span><span class="p">,</span> <span class="n">tab</span><span class="o">.</span><span class="n">_desc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)))</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">_units</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">u</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
            <span class="n">cards</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;TUNIT</span><span class="si">{0:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">tab</span><span class="o">.</span><span class="n">_units</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                          <span class="s1">&#39;unit of </span><span class="si">{0:s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">)))</span>

    <span class="c1"># add aliases</span>
    <span class="k">for</span> <span class="n">e</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">_aliases</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="n">cards</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="s1">&#39;ALIAS</span><span class="si">{0:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;=&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">)</span>

    <span class="k">if</span> <span class="n">tab</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;No Name&#39;</span><span class="p">]:</span>
        <span class="n">cards</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;EXTNAME&#39;</span><span class="p">,</span> <span class="n">tab</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">],</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>

    <span class="n">hdr</span> <span class="o">=</span> <span class="n">pyfits</span><span class="o">.</span><span class="n">Header</span><span class="p">(</span><span class="n">cards</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tab</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;NAME&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;COMMENT&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;HISTORY&#39;</span><span class="p">):</span>
                <span class="n">hdr</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">txt</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">txt</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;COMMENT&#39;</span><span class="p">:</span>
                        <span class="n">hdr</span><span class="o">.</span><span class="n">add_comment</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;HISTORY&#39;</span><span class="p">:</span>
                        <span class="n">hdr</span><span class="o">.</span><span class="n">add_history</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">hdr</span>


<span class="k">def</span> <span class="nf">_fits_writeto</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_verify</span><span class="o">=</span><span class="s1">&#39;exception&#39;</span><span class="p">,</span>
                  <span class="n">clobber</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">checksum</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new FITS file using the supplied data/header.</span>
<span class="sd">    Patched version of pyfits to correctly include provided header</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : file path, file object, or file like object</span>
<span class="sd">        File to write to.  If opened, must be opened in a writeable binary</span>
<span class="sd">        mode such as &#39;wb&#39; or &#39;ab+&#39;.</span>

<span class="sd">    data : array, record array, or groups data object</span>
<span class="sd">        data to write to the new file</span>

<span class="sd">    header : `Header` object, optional</span>
<span class="sd">        the header associated with ``data``. If `None`, a header</span>
<span class="sd">        of the appropriate type is created for the supplied data. This</span>
<span class="sd">        argument is optional.</span>

<span class="sd">    output_verify : str</span>
<span class="sd">        Output verification option.  Must be one of ``&quot;fix&quot;``, ``&quot;silentfix&quot;``,</span>
<span class="sd">        ``&quot;ignore&quot;``, ``&quot;warn&quot;``, or ``&quot;exception&quot;``.  May also be any</span>
<span class="sd">        combination of ``&quot;fix&quot;`` or ``&quot;silentfix&quot;`` with ``&quot;+ignore&quot;``,</span>
<span class="sd">        ``+warn``, or ``+exception&quot; (e.g. ``&quot;fix+warn&quot;``).  See :ref:`verify`</span>
<span class="sd">        for more info.</span>

<span class="sd">    clobber : bool, optional</span>
<span class="sd">        If `True`, and if filename already exists, it will overwrite</span>
<span class="sd">        the file.  Default is `False`.</span>

<span class="sd">    checksum : bool, optional</span>
<span class="sd">        If `True`, adds both ``DATASUM`` and ``CHECKSUM`` cards to the</span>
<span class="sd">        headers of all HDU&#39;s written to the file</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">hdu</span> <span class="o">=</span> <span class="n">pyfits</span><span class="o">.</span><span class="n">convenience</span><span class="o">.</span><span class="n">_makehdu</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">header</span><span class="p">)</span>
    <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">cards</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">hdu</span><span class="o">.</span><span class="n">is_image</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hdu</span><span class="p">,</span> <span class="n">pyfits</span><span class="o">.</span><span class="n">PrimaryHDU</span><span class="p">):</span>
        <span class="n">hdu</span> <span class="o">=</span> <span class="n">pyfits</span><span class="o">.</span><span class="n">PrimaryHDU</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">)</span>
    <span class="n">hdu</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">clobber</span><span class="o">=</span><span class="n">clobber</span><span class="p">,</span> <span class="n">output_verify</span><span class="o">=</span><span class="n">output_verify</span><span class="p">,</span>
                <span class="n">checksum</span><span class="o">=</span><span class="n">checksum</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_fits_append</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">checksum</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Append the header/data to FITS file if filename exists, create if not.</span>

<span class="sd">    If only ``data`` is supplied, a minimal header is created.</span>
<span class="sd">    Patched version of pyfits to correctly include provided header</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : file path, file object, or file like object</span>
<span class="sd">        File to write to.  If opened, must be opened for update (rb+) unless it</span>
<span class="sd">        is a new file, then it must be opened for append (ab+).  A file or</span>
<span class="sd">        `~gzip.GzipFile` object opened for update will be closed after return.</span>

<span class="sd">    data : array, table, or group data object</span>
<span class="sd">        the new data used for appending</span>

<span class="sd">    header : `Header` object, optional</span>
<span class="sd">        The header associated with ``data``.  If `None`, an appropriate header</span>
<span class="sd">        will be created for the data object supplied.</span>

<span class="sd">    checksum : bool, optional</span>
<span class="sd">        When `True` adds both ``DATASUM`` and ``CHECKSUM`` cards to the header</span>
<span class="sd">        of the HDU when written to the file.</span>

<span class="sd">    verify : bool, optional</span>
<span class="sd">        When `True`, the existing FITS file will be read in to verify it for</span>
<span class="sd">        correctness before appending.  When `False`, content is simply appended</span>
<span class="sd">        to the end of the file.  Setting ``verify`` to `False` can be much</span>
<span class="sd">        faster.</span>

<span class="sd">    kwargs</span>
<span class="sd">        Any additional keyword arguments to be passed to</span>
<span class="sd">        `astropy.io.fits.open`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">,</span> <span class="n">closed</span><span class="p">,</span> <span class="n">noexist_or_empty</span> <span class="o">=</span> <span class="n">pyfits</span><span class="o">.</span><span class="n">convenience</span><span class="o">.</span><span class="n">_stat_filename_or_fileobj</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">noexist_or_empty</span><span class="p">:</span>
        <span class="c1">#</span>
        <span class="c1"># The input file or file like object either doesn&#39;t exits or is</span>
        <span class="c1"># empty.  Use the writeto convenience function to write the</span>
        <span class="c1"># output to the empty object.</span>
        <span class="c1">#</span>
        <span class="n">_fits_writeto</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">checksum</span><span class="o">=</span><span class="n">checksum</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hdu</span> <span class="o">=</span> <span class="n">pyfits</span><span class="o">.</span><span class="n">convenience</span><span class="o">.</span><span class="n">_makehdu</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">header</span><span class="p">)</span>
        <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">cards</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hdu</span><span class="p">,</span> <span class="n">pyfits</span><span class="o">.</span><span class="n">PrimaryHDU</span><span class="p">):</span>
            <span class="n">hdu</span> <span class="o">=</span> <span class="n">pyfits</span><span class="o">.</span><span class="n">ImageHDU</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">header</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">verify</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">closed</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">pyfits</span><span class="o">.</span><span class="n">convenience</span><span class="o">.</span><span class="n">fitsopen</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;append&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hdu</span><span class="p">)</span>

            <span class="c1"># Set a flag in the HDU so that only this HDU gets a checksum when</span>
            <span class="c1"># writing the file.</span>
            <span class="n">hdu</span><span class="o">.</span><span class="n">_output_checksum</span> <span class="o">=</span> <span class="n">checksum</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">closed</span><span class="o">=</span><span class="n">closed</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">pyfits</span><span class="o">.</span><span class="n">convenience</span><span class="o">.</span><span class="n">_File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;append&#39;</span><span class="p">)</span>
            <span class="n">hdu</span><span class="o">.</span><span class="n">_output_checksum</span> <span class="o">=</span> <span class="n">checksum</span>
            <span class="n">hdu</span><span class="o">.</span><span class="n">_writeto</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_ascii_read_header</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">commentedHeader</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read ASCII/CSV header</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fname: str or stream</span>
<span class="sd">        File, filename, or generator to read.</span>
<span class="sd">        Note that generators should return byte strings for Python 3k.</span>

<span class="sd">    comments: str, optional</span>
<span class="sd">        The character used to indicate the start of a comment;</span>
<span class="sd">        default: &#39;#&#39;.</span>

<span class="sd">    delimiter: str, optional</span>
<span class="sd">        The string used to separate values.  By default, this is any</span>
<span class="sd">        whitespace.</span>

<span class="sd">    commentedHeader: bool, optional</span>
<span class="sd">        if set, the last line of the header is expected to be the column titles</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    nlines: int</span>
<span class="sd">        number of lines from the header</span>

<span class="sd">    header: dict</span>
<span class="sd">        header dictionary</span>

<span class="sd">    alias: dict</span>
<span class="sd">        aliases</span>

<span class="sd">    units: dict</span>
<span class="sd">        units</span>

<span class="sd">    comments: dict</span>
<span class="sd">        comments/description of keywords</span>

<span class="sd">    names: sequence</span>
<span class="sd">        sequence or str, first data line after header, expected to be the column</span>
<span class="sd">        names.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;read&#39;</span><span class="p">):</span>
        <span class="n">stream</span> <span class="o">=</span> <span class="n">fname</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">stream</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>

    <span class="n">header</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">alias</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">units</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">desc</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">parseStrNone</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; robust parse &quot;&quot;&quot;</span>
        <span class="n">_v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_v</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_v</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_v</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">_v</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span> <span class="ow">or</span> <span class="p">(</span><span class="n">_v</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;null&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_v</span>

    <span class="n">done</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">oldline</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">lasthdr</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">nlines</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">header</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;COMMENT&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">header</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;HISTORY&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">done</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">readline</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># getting rid of &#39;\n&#39;</span>
        <span class="n">nlines</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">comments</span><span class="p">):</span>  <span class="c1"># header part</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">comments</span><span class="p">:</span>  <span class="c1"># column meta data</span>
                    <span class="c1"># column meta is expected to start with ##</span>
                    <span class="n">k</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">colname</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">colunit</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">colcomm</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">colunit</span> <span class="o">=</span> <span class="n">parseStrNone</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">colcomm</span> <span class="o">=</span> <span class="n">parseStrNone</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

                    <span class="k">if</span> <span class="n">colunit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">units</span><span class="p">[</span><span class="n">colname</span><span class="p">]</span> <span class="o">=</span> <span class="n">colunit</span>
                    <span class="k">if</span> <span class="n">colcomm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">desc</span><span class="p">[</span><span class="n">colname</span><span class="p">]</span> <span class="o">=</span> <span class="n">colcomm</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># header is expected as &quot;# key \t value&quot;</span>
                    <span class="n">k</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># remove trainling spaces</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s1">&#39;NONE&#39;</span><span class="p">,</span> <span class="s1">&#39;COMMENT&#39;</span><span class="p">):</span>
                            <span class="n">header</span><span class="p">[</span><span class="s1">&#39;COMMENT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="s1">&#39;COMMENT&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">val</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;HISTORY&#39;</span><span class="p">,</span> <span class="p">):</span>
                            <span class="n">header</span><span class="p">[</span><span class="s1">&#39;HISTORY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="s1">&#39;HISTORY&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">val</span>
                        <span class="k">elif</span> <span class="s1">&#39;alias&#39;</span> <span class="ow">in</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                            <span class="c1"># take care of aliases</span>
                            <span class="n">al</span><span class="p">,</span> <span class="n">orig</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                            <span class="n">alias</span><span class="p">[</span><span class="n">al</span><span class="p">]</span> <span class="o">=</span> <span class="n">orig</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">header</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                        <span class="n">lasthdr</span> <span class="o">=</span> <span class="n">key</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;COMMENT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="s1">&#39;COMMENT&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">done</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">commentedHeader</span> <span class="ow">and</span> <span class="p">(</span><span class="n">oldline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">names</span> <span class="o">=</span> <span class="n">oldline</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delimiter</span><span class="p">)</span>
                <span class="n">nlines</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">lasthdr</span> <span class="o">==</span> <span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">header</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">lasthdr</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">names</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delimiter</span><span class="p">)</span>
        <span class="n">oldline</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;read&#39;</span><span class="p">):</span>
        <span class="n">stream</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">stream</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">stream</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
        <span class="n">nlines</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># make sure the value is set to the current position</span>

    <span class="k">return</span> <span class="n">nlines</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">alias</span><span class="p">,</span> <span class="n">names</span>


<span class="k">def</span> <span class="nf">_hdf5_write_data</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">tablename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">header</span><span class="o">=</span><span class="p">{},</span> <span class="n">units</span><span class="o">=</span><span class="p">{},</span> <span class="n">comments</span><span class="o">=</span><span class="p">{},</span> <span class="n">aliases</span><span class="o">=</span><span class="p">{},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Write table into HDF format</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : file path, or tables.File instance</span>
<span class="sd">        File to write to.  If opened, must be opened and writable (mode=&#39;w&#39; or &#39;a&#39;)</span>

<span class="sd">    data: recarray</span>
<span class="sd">        data to write to the new file</span>

<span class="sd">    tablename: str</span>
<span class="sd">        path of the node including table&#39;s name</span>

<span class="sd">    mode: str</span>
<span class="sd">        in (&#39;w&#39;, &#39;a&#39;) mode to open the file</span>

<span class="sd">    append: bool</span>
<span class="sd">        if set, tends to append data to an existing table</span>

<span class="sd">    header: dict</span>
<span class="sd">        table header</span>

<span class="sd">    units: dict</span>
<span class="sd">        dictionary of units</span>

<span class="sd">    alias: dict</span>
<span class="sd">        aliases</span>

<span class="sd">    comments: dict</span>
<span class="sd">        comments/description of keywords</span>

<span class="sd">    .. note::</span>
<span class="sd">        other keywords are forwarded to :func:`tables.openFile`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;read&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;HDF backend does not implement stream&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">append</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span>
    <span class="n">silent</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;silent&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">tables</span><span class="o">.</span><span class="n">File</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">filename</span><span class="o">.</span><span class="n">mode</span> <span class="o">!=</span> <span class="n">mode</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">mode</span> <span class="o">!=</span> <span class="s1">&#39;r&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">tables</span><span class="o">.</span><span class="n">FileModeError</span><span class="p">(</span><span class="s1">&#39;The file is already opened in a different mode&#39;</span><span class="p">)</span>
        <span class="n">hd5</span> <span class="o">=</span> <span class="n">filename</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hd5</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">openFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>

    <span class="c1"># check table name and path</span>
    <span class="n">tablename</span> <span class="o">=</span> <span class="n">tablename</span> <span class="ow">or</span> <span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NAME&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tablename</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Noname&#39;</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">):</span>
        <span class="n">tablename</span> <span class="o">=</span> <span class="s1">&#39;/data&#39;</span>

    <span class="n">w</span> <span class="o">=</span> <span class="n">tablename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="n">where</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">w</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">where</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">where</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>
    <span class="k">if</span> <span class="n">where</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
        <span class="n">where</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">where</span>

    <span class="k">if</span> <span class="n">append</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">hd5</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="n">where</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">description</span><span class="o">.</span><span class="n">_v_dtype</span><span class="p">))</span>
            <span class="n">t</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">tables</span><span class="o">.</span><span class="n">NoSuchNodeError</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;Warning: Table </span><span class="si">{0}</span><span class="s2"> does not exists.  </span><span class="se">\n</span><span class="s2"> A new table will be created&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">where</span> <span class="o">+</span> <span class="n">name</span><span class="p">))</span>
            <span class="n">append</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">append</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">hd5</span><span class="o">.</span><span class="n">createTable</span><span class="p">(</span><span class="n">where</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># update header</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">header</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;FILTERS&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;VERSION&#39;</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mf">2.0</span><span class="p">):</span>
                <span class="n">t</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">t</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">if</span> <span class="s1">&#39;TITLE&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
            <span class="n">t</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;TITLE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>

        <span class="c1"># add column descriptions and units</span>
        <span class="k">for</span> <span class="n">e</span><span class="p">,</span> <span class="n">colname</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">):</span>
            <span class="n">_u</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">colname</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">_d</span> <span class="o">=</span> <span class="n">comments</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">colname</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">_u</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">t</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;FIELD_</span><span class="si">{0:d}</span><span class="s1">_UNIT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_u</span>
            <span class="k">if</span> <span class="n">_d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">t</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;FIELD_</span><span class="si">{0:d}</span><span class="s1">_DESC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_d</span>

        <span class="c1"># add aliases</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">aliases</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">t</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;ALIAS</span><span class="si">{0:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:s}</span><span class="s1">=</span><span class="si">{1:s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

        <span class="n">t</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">tables</span><span class="o">.</span><span class="n">File</span><span class="p">):</span>
        <span class="n">hd5</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="n">hd5</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_hdf5_read_data</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">tablename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Generate the corresponding ascii Header that contains all necessary info</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename: str</span>
<span class="sd">        file to read from</span>

<span class="sd">    tablename: str</span>
<span class="sd">        node containing the table</span>

<span class="sd">    silent: bool</span>
<span class="sd">        skip verbose messages</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    hdr: str</span>
<span class="sd">        string that will be be written at the beginning of the file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">openFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">tablename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">listNodes</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">tablename</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">tablename</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">tablename</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="n">tablename</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Loading table: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tablename</span><span class="p">))</span>

    <span class="n">hdr</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">aliases</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># read header</span>
    <span class="n">exclude</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;NROWS&#39;</span><span class="p">,</span> <span class="s1">&#39;VERSION&#39;</span><span class="p">,</span> <span class="s1">&#39;CLASS&#39;</span><span class="p">,</span> <span class="s1">&#39;EXTNAME&#39;</span><span class="p">,</span> <span class="s1">&#39;TITLE&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">_v_attrnames</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">k</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;FIELD&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">k</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;ALIAS&#39;</span><span class="p">):</span>
                <span class="n">hdr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">k</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ALIAS&#39;</span><span class="p">:</span>
                <span class="n">c0</span><span class="p">,</span> <span class="n">c1</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                <span class="n">aliases</span><span class="p">[</span><span class="n">c0</span><span class="p">]</span> <span class="o">=</span> <span class="n">c1</span>

    <span class="n">empty_name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s1">&#39;Noname&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;TITLE&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">empty_name</span><span class="p">:</span>
        <span class="n">hdr</span><span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;TITLE&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hdr</span><span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:s}</span><span class="s1">/</span><span class="si">{1:s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="c1"># read column meta</span>
    <span class="n">units</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">desc</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">colname</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">colnames</span><span class="p">):</span>
        <span class="n">_u</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="s1">&#39;FIELD_</span><span class="si">{0:d}</span><span class="s1">_UNIT&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">_d</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="s1">&#39;FIELD_</span><span class="si">{0:d}</span><span class="s1">_DESC&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_u</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">units</span><span class="p">[</span><span class="n">colname</span><span class="p">]</span> <span class="o">=</span> <span class="n">_u</span>
        <span class="k">if</span> <span class="n">_d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">desc</span><span class="p">[</span><span class="n">colname</span><span class="p">]</span> <span class="o">=</span> <span class="n">_d</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">node</span><span class="p">[:]</span>

    <span class="n">source</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">hdr</span><span class="p">,</span> <span class="n">aliases</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">data</span>


<span class="k">def</span> <span class="nf">_ascii_generate_header</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span>
                           <span class="n">commentedHeader</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Generate the corresponding ascii Header that contains all necessary info</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    tab: SimpleTable instance</span>
<span class="sd">        table</span>

<span class="sd">    comments: str</span>
<span class="sd">        string to prepend header lines</span>

<span class="sd">    delimiter: str, optional</span>
<span class="sd">        The string used to separate values.  By default, this is any</span>
<span class="sd">        whitespace.</span>

<span class="sd">    commentedHeader: bool, optional</span>
<span class="sd">        if set, the last line of the header is expected to be the column titles</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    hdr: str</span>
<span class="sd">        string that will be be written at the beginning of the file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hdr</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">comments</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">comments</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="c1"># table header</span>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">tab</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;{{0:s}} {{1:</span><span class="si">{0:d}</span><span class="s1">s}}</span><span class="se">\t</span><span class="s1">{{2:s}}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tab</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">vk</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vk</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">hdr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">comments</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">vk</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>

    <span class="c1"># column metadata</span>
    <span class="n">hdr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comments</span><span class="p">)</span>  <span class="c1"># add empty line</span>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">tab</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;{{0:s}}{{0:s}} {{1:</span><span class="si">{0:d}</span><span class="s1">s}}</span><span class="se">\t</span><span class="s1">{{2:s}}</span><span class="se">\t</span><span class="s1">{{3:s}}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">colname</span> <span class="ow">in</span> <span class="n">tab</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">unit</span> <span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">_units</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">colname</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">)</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">_desc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">colname</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">)</span>
        <span class="n">hdr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">comments</span><span class="p">,</span> <span class="n">colname</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">desc</span><span class="p">))</span>

    <span class="c1"># aliases</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">_aliases</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">hdr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comments</span><span class="p">)</span>  <span class="c1"># add empty line</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tab</span><span class="o">.</span><span class="n">_aliases</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">hdr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:s}</span><span class="s1"> alias</span><span class="se">\t</span><span class="si">{1:s}</span><span class="s1">=</span><span class="si">{2:s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">comments</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>

    <span class="c1"># column names</span>
    <span class="n">hdr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comments</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">commentedHeader</span><span class="p">:</span>
        <span class="n">hdr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:s}</span><span class="s1"> </span><span class="si">{1:s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">comments</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hdr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">delimiter</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>

    <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hdr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_latex_writeto</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">tab</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="s1">&#39;%&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Write the data into a latex table format</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename: str</span>
<span class="sd">        file or unit to write into</span>

<span class="sd">    tab: SimpleTable instance</span>
<span class="sd">        table</span>

<span class="sd">    comments: str</span>
<span class="sd">        string to prepend header lines</span>

<span class="sd">    delimiter: str, optional</span>
<span class="sd">        The string used to separate values.  By default, this is any</span>
<span class="sd">        whitespace.</span>

<span class="sd">    commentedHeader: bool, optional</span>
<span class="sd">        if set, the last line of the header is expected to be the column titles</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">txt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">begin</span><span class="si">{table}</span><span class="se">\n\\</span><span class="s2">begin</span><span class="si">{center}</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="c1"># add caption</span>
    <span class="n">tabname</span> <span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NAME&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tabname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">]:</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">caption{{</span><span class="si">{0:s}</span><span class="s2">}}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tabname</span><span class="p">)</span>

    <span class="c1"># tabular</span>
    <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">begin{{tabular}}{{</span><span class="si">{0:s}</span><span class="s1">}}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;c&#39;</span> <span class="o">*</span> <span class="n">tab</span><span class="o">.</span><span class="n">ncols</span><span class="p">)</span>
    <span class="n">txt</span> <span class="o">+=</span> <span class="n">tab</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">delim</span><span class="o">=</span><span class="s1">&#39; &amp; &#39;</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="s1">&#39;MAG*&#39;</span><span class="p">,</span> <span class="n">headerChar</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">endline</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\\\\\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ret</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">end</span><span class="si">{tabular}</span><span class="se">\n</span><span class="s1">&#39;</span>

    <span class="c1"># end table</span>
    <span class="n">txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">end</span><span class="si">{center}</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="c1"># add notes if any</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">_desc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;\% notes </span><span class="se">\n\\</span><span class="s1">begin</span><span class="si">{scriptsize}</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">e</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">_desc</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{0:d}</span><span class="s1"> </span><span class="si">{1:s}</span><span class="s1">: </span><span class="si">{2:s}</span><span class="s1"> </span><span class="se">\\\\\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">end</span><span class="si">{scriptsize}</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">end</span><span class="si">{table}</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;write&#39;</span><span class="p">):</span>
        <span class="n">filename</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">unit</span><span class="p">:</span>
            <span class="n">unit</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_convert_dict_to_structured_ndarray</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;convert_dict_to_structured_ndarray</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    data: dictionary like object</span>
<span class="sd">        data structure which provides iteritems and itervalues</span>

<span class="sd">    returns</span>
<span class="sd">    -------</span>
<span class="sd">    tab: structured ndarray</span>
<span class="sd">        structured numpy array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">newdtype</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">dk</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="n">_dk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">dk</span><span class="p">)</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">_dk</span><span class="o">.</span><span class="n">dtype</span>
            <span class="c1"># unknown type is converted to text</span>
            <span class="k">if</span> <span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">object_</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">longest</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">longest</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">_dk</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">))</span>
                    <span class="n">_dk</span> <span class="o">=</span> <span class="n">_dk</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;|</span><span class="si">%i</span><span class="s1">S&#39;</span> <span class="o">%</span> <span class="n">longest</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">_dk</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">newdtype</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">_dk</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="p">(</span><span class="n">_dk</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">newdtype</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">_dk</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>
        <span class="n">tab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">fromarrays</span><span class="p">(</span><span class="n">itervalues</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">newdtype</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># not a dict</span>
        <span class="c1"># hope it&#39;s a tuple ((key, value),) pairs.</span>
        <span class="kn">from</span> <span class="nn">itertools</span> <span class="k">import</span> <span class="n">tee</span>
        <span class="n">d1</span><span class="p">,</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">tee</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">dk</span> <span class="ow">in</span> <span class="n">d1</span><span class="p">:</span>
            <span class="n">_dk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">dk</span><span class="p">)</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">_dk</span><span class="o">.</span><span class="n">dtype</span>
            <span class="c1"># unknown type is converted to text</span>
            <span class="k">if</span> <span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">object_</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">longest</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">longest</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">_dk</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">))</span>
                    <span class="n">_dk</span> <span class="o">=</span> <span class="n">_dk</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;|</span><span class="si">%i</span><span class="s1">S&#39;</span> <span class="o">%</span> <span class="n">longest</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">_dk</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">newdtype</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">_dk</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="p">(</span><span class="n">_dk</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">newdtype</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">_dk</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>
        <span class="n">tab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">fromarrays</span><span class="p">((</span><span class="n">dk</span> <span class="k">for</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">dk</span><span class="p">)</span> <span class="ow">in</span> <span class="n">d2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">newdtype</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">tab</span>


<span class="k">def</span> <span class="nf">__indent__</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">headerChar</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
               <span class="n">delim</span><span class="o">=</span><span class="s1">&#39; | &#39;</span><span class="p">,</span> <span class="n">endline</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Indents a table by column.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rows: sequences of rows</span>
<span class="sd">        one sequence per row.</span>

<span class="sd">    header: sequence of str</span>
<span class="sd">        row consists of the columns&#39; names</span>

<span class="sd">    units: sequence of str</span>
<span class="sd">        Sequence of units</span>

<span class="sd">    headerChar: char</span>
<span class="sd">        Character to be used for the row separator line</span>

<span class="sd">    delim: char</span>
<span class="sd">        The column delimiter.</span>

<span class="sd">    returns</span>
<span class="sd">    -------</span>
<span class="sd">    txt: str</span>
<span class="sd">        string represation of rows</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">length_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">max</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">])))</span>
    <span class="n">length</span> <span class="o">=</span> <span class="n">length_data</span><span class="p">[:]</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">header</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">length_header</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">header</span><span class="p">))</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">max</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="n">length_data</span><span class="p">,</span> <span class="n">length_header</span><span class="p">)))</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">length_units</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">units</span><span class="p">))</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">max</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="n">length_data</span><span class="p">,</span> <span class="n">length_units</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">headerChar</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">):</span>
        <span class="n">rowSeparator</span> <span class="o">=</span> <span class="n">headerChar</span> <span class="o">*</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">length</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">delim</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">length</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="n">endline</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rowSeparator</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="c1"># make the format</span>
    <span class="n">fmt</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;{{</span><span class="si">{0:d}</span><span class="s1">:</span><span class="si">{1:d}</span><span class="s1">s}}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">length</span><span class="p">)]</span>
    <span class="n">fmt</span> <span class="o">=</span> <span class="n">delim</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span> <span class="o">+</span> <span class="n">endline</span>
    <span class="c1"># write the string</span>
    <span class="n">txt</span> <span class="o">=</span> <span class="n">rowSeparator</span>
    <span class="k">if</span> <span class="n">header</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">header</span><span class="p">)</span>  <span class="c1"># + endline</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="n">rowSeparator</span>
    <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">units</span><span class="p">)</span>  <span class="c1"># + endline</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="n">rowSeparator</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">r</span><span class="p">)</span>  <span class="c1"># + endline</span>
    <span class="n">txt</span> <span class="o">+=</span> <span class="n">rowSeparator</span>
    <span class="k">return</span> <span class="n">txt</span>


<span class="k">def</span> <span class="nf">pprint_rec_entry</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; print one line with key and values properly to be readable</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data: recarray</span>
<span class="sd">            data to extract entry from</span>

<span class="sd">        num: int, slice</span>
<span class="sd">            indice selection</span>

<span class="sd">        keys: sequence or str</span>
<span class="sd">            if str, can be a regular expression</span>
<span class="sd">            if sequence, the sequence of keys to print</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">keys</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">keys</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">):</span>
            <span class="n">_keys</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="ow">in</span> <span class="n">basestring</span><span class="p">:</span>
            <span class="n">_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span> <span class="k">if</span> <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_keys</span> <span class="o">=</span> <span class="n">keys</span>

        <span class="n">length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">_keys</span><span class="p">))</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;{{0:</span><span class="si">{0:d}</span><span class="s1">s}}: {{1}}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">num</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">_keys</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>


<span class="k">def</span> <span class="nf">pprint_rec_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ret</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">headerChar</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">delim</span><span class="o">=</span><span class="s1">&#39; | &#39;</span><span class="p">,</span> <span class="n">endline</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Pretty print the table content</span>
<span class="sd">            you can select the table parts to display using idx to</span>
<span class="sd">            select the rows and fields to only display some columns</span>
<span class="sd">            (ret is only for insternal use)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data: array</span>
<span class="sd">            array to show</span>

<span class="sd">        idx: sequence, slide</span>
<span class="sd">            sub selection to print</span>

<span class="sd">        fields: str, sequence</span>
<span class="sd">            if str can be a regular expression, and/or list of fields separated</span>
<span class="sd">            by spaces or commas</span>

<span class="sd">        ret: bool</span>
<span class="sd">            if set return the string representation instead of printing the result</span>

<span class="sd">        all: bool</span>
<span class="sd">            if set, force to show all rows</span>

<span class="sd">        headerChar: char</span>
<span class="sd">            Character to be used for the row separator line</span>

<span class="sd">        delim: char</span>
<span class="sd">            The column delimiter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">fields</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">fields</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">):</span>
            <span class="n">_keys</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span> <span class="ow">in</span> <span class="n">basestring</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;,&#39;</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                <span class="n">_fields</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s1">&#39; &#39;</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                <span class="n">_fields</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">fields</span><span class="p">]</span>
            <span class="n">lbls</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span>
            <span class="n">_keys</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">_fk</span> <span class="ow">in</span> <span class="n">_fields</span><span class="p">:</span>
                <span class="n">_keys</span> <span class="o">+=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">lbls</span> <span class="k">if</span> <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">_fk</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lbls</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span>
            <span class="n">_keys</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">_fk</span> <span class="ow">in</span> <span class="n">_fields</span><span class="p">:</span>
                <span class="n">_keys</span> <span class="o">+=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">lbls</span> <span class="k">if</span> <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">_fk</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)]</span>

        <span class="n">nfields</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">_keys</span><span class="p">)</span>
        <span class="n">nrows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_keys</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">nrows</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">all</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">):</span>
                <span class="n">rows</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">rk</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">_keys</span> <span class="p">]</span> <span class="k">for</span> <span class="n">rk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrows</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_idx</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
                <span class="n">rows</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">rk</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">_keys</span> <span class="p">]</span> <span class="k">for</span> <span class="n">rk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="p">]</span>
                <span class="k">if</span> <span class="n">nfields</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">rows</span> <span class="o">+=</span> <span class="p">[</span> <span class="p">[</span><span class="s1">&#39;...&#39;</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nfields</span><span class="p">)</span> <span class="p">]</span> <span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rows</span> <span class="o">+=</span> <span class="p">[</span> <span class="p">[</span><span class="s1">&#39;...&#39;</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nfields</span><span class="p">)</span> <span class="p">]</span> <span class="p">]</span>
                <span class="n">rows</span> <span class="o">+=</span> <span class="p">[</span> <span class="p">[</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">rk</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">fields</span> <span class="p">]</span> <span class="k">for</span> <span class="n">rk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="n">_idx</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">idx</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span> <span class="n">idx</span><span class="o">.</span><span class="n">step</span> <span class="ow">or</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">rk</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">fields</span> <span class="p">]</span> <span class="k">for</span> <span class="n">rk</span> <span class="ow">in</span> <span class="n">_idx</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">rk</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">fields</span> <span class="p">]</span> <span class="k">for</span> <span class="n">rk</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">]</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">__indent__</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">_keys</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delim</span><span class="o">=</span><span class="n">delim</span><span class="p">,</span>
                         <span class="n">headerChar</span><span class="o">=</span><span class="n">headerChar</span><span class="p">,</span> <span class="n">endline</span><span class="o">=</span><span class="n">endline</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ret</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">out</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">elementwise</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Quick and dirty elementwise function decorator it provides a quick way</span>
<span class="sd">    to apply a function either on one element or a sequence of elements</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="n">_f</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="n">_f</span><span class="p">,</span> <span class="n">it</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>


<div class="viewcode-block" id="AstroHelpers"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.AstroHelpers">[docs]</a><span class="k">class</span> <span class="nc">AstroHelpers</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Helpers related to astronomy data &quot;&quot;&quot;</span>

<div class="viewcode-block" id="AstroHelpers.hms2deg"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.AstroHelpers.hms2deg">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="nd">@elementwise</span>
    <span class="k">def</span> <span class="nf">hms2deg</span><span class="p">(</span><span class="n">_str</span><span class="p">,</span> <span class="n">delim</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Convert hex coordinates into degrees</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        str: string or sequence</span>
<span class="sd">            string to convert</span>

<span class="sd">        delimiter: str</span>
<span class="sd">            character delimiting the fields</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        deg: float</span>
<span class="sd">            angle in degrees</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
            <span class="n">neg</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">_str</span> <span class="o">=</span> <span class="n">_str</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">neg</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">_str</span> <span class="o">=</span> <span class="n">_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delim</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">neg</span> <span class="o">*</span> <span class="p">((((</span><span class="nb">float</span><span class="p">(</span><span class="n">_str</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mf">60.</span> <span class="o">+</span>
                         <span class="nb">float</span><span class="p">(</span><span class="n">_str</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">/</span> <span class="mf">60.</span> <span class="o">+</span>
                        <span class="nb">float</span><span class="p">(</span><span class="n">_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">/</span> <span class="mf">24.</span> <span class="o">*</span> <span class="mf">360.</span><span class="p">))</span></div>

<div class="viewcode-block" id="AstroHelpers.deg2dms"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.AstroHelpers.deg2dms">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="nd">@elementwise</span>
    <span class="k">def</span> <span class="nf">deg2dms</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">delim</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Convert degrees into hex coordinates</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        deg: float</span>
<span class="sd">            angle in degrees</span>

<span class="sd">        delimiter: str</span>
<span class="sd">            character delimiting the fields</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str: string or sequence</span>
<span class="sd">            string to convert</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sign</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sign</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">d</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">sign</span> <span class="o">*</span> <span class="n">val</span> <span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="p">(</span><span class="n">sign</span> <span class="o">*</span> <span class="n">val</span> <span class="o">-</span> <span class="n">d</span><span class="p">)</span> <span class="o">*</span> <span class="mf">60.</span> <span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">((</span> <span class="n">sign</span> <span class="o">*</span> <span class="n">val</span> <span class="o">-</span> <span class="n">d</span><span class="p">)</span> <span class="o">*</span> <span class="mf">60.</span>  <span class="o">-</span> <span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="mf">60.</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">{0}{1}{2}{3}{4}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">sign</span> <span class="o">*</span> <span class="n">d</span><span class="p">,</span> <span class="n">delim</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">delim</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span></div>

<div class="viewcode-block" id="AstroHelpers.deg2hms"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.AstroHelpers.deg2hms">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="nd">@elementwise</span>
    <span class="k">def</span> <span class="nf">deg2hms</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">delim</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Convert degrees into hex coordinates</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        deg: float</span>
<span class="sd">            angle in degrees</span>

<span class="sd">        delimiter: str</span>
<span class="sd">            character delimiting the fields</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str: string or sequence</span>
<span class="sd">            string to convert</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sign</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sign</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">sign</span> <span class="o">*</span> <span class="n">val</span> <span class="o">/</span> <span class="mf">45.</span> <span class="o">*</span> <span class="mf">3.</span><span class="p">)</span>   <span class="c1"># * 24 / 360</span>
        <span class="n">m</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="p">(</span><span class="n">sign</span> <span class="o">*</span> <span class="n">val</span> <span class="o">/</span> <span class="mf">45.</span> <span class="o">*</span> <span class="mf">3.</span> <span class="o">-</span> <span class="n">h</span><span class="p">)</span> <span class="o">*</span> <span class="mf">60.</span> <span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">((</span> <span class="n">sign</span> <span class="o">*</span> <span class="n">val</span> <span class="o">/</span> <span class="mf">45.</span> <span class="o">*</span> <span class="mf">3.</span> <span class="o">-</span> <span class="n">h</span><span class="p">)</span> <span class="o">*</span> <span class="mf">60.</span>  <span class="o">-</span> <span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="mf">60.</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">{0}{1}{2}{3}{4}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">sign</span> <span class="o">*</span> <span class="n">h</span><span class="p">,</span> <span class="n">delim</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">delim</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span></div>

<div class="viewcode-block" id="AstroHelpers.dms2deg"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.AstroHelpers.dms2deg">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="nd">@elementwise</span>
    <span class="k">def</span> <span class="nf">dms2deg</span><span class="p">(</span><span class="n">_str</span><span class="p">,</span> <span class="n">delim</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Convert hex coordinates into degrees</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        str: string or sequence</span>
<span class="sd">            string to convert</span>

<span class="sd">        delimiter: str</span>
<span class="sd">            character delimiting the fields</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        deg: float</span>
<span class="sd">            angle in degrees</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
            <span class="n">neg</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">_str</span> <span class="o">=</span> <span class="n">_str</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">neg</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">_str</span> <span class="o">=</span> <span class="n">_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delim</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">neg</span> <span class="o">*</span> <span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="n">_str</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mf">60.</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">_str</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">/</span> <span class="mf">60.</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">_str</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span></div>

<div class="viewcode-block" id="AstroHelpers.euler"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.AstroHelpers.euler">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="nd">@elementwise</span>
    <span class="k">def</span> <span class="nf">euler</span><span class="p">(</span><span class="n">ai_in</span><span class="p">,</span> <span class="n">bi_in</span><span class="p">,</span> <span class="n">select</span><span class="p">,</span> <span class="n">b1950</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;f8&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transform between Galactic, celestial, and ecliptic coordinates.</span>
<span class="sd">        Celestial coordinates (RA, Dec) should be given in equinox J2000</span>
<span class="sd">        unless the b1950 is True.</span>

<span class="sd">        select From           To         |   select    From          To</span>
<span class="sd">        ----------------------------------------------------------------------</span>
<span class="sd">        1      RA-Dec (2000)  Galactic   |     4       Ecliptic      RA-Dec</span>
<span class="sd">        2      Galactic       RA-DEC     |     5       Ecliptic      Galactic</span>
<span class="sd">        3      RA-Dec         Ecliptic   |     6       Galactic      Ecliptic</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        long_in: float, or sequence</span>
<span class="sd">            Input Longitude in DEGREES, scalar or vector.</span>

<span class="sd">        lat_in: float, or sequence</span>
<span class="sd">            Latitude in DEGREES</span>

<span class="sd">        select: int</span>
<span class="sd">            Integer from 1 to 6 specifying type of coordinate transformation.</span>

<span class="sd">        b1950: bool</span>
<span class="sd">            set equinox set to 1950</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        long_out: float, seq</span>
<span class="sd">            Output Longitude in DEGREES</span>

<span class="sd">        lat_out: float, seq</span>
<span class="sd">            Output Latitude in DEGREES</span>


<span class="sd">        REVISION HISTORY:</span>
<span class="sd">        Written W. Landsman,  February 1987</span>
<span class="sd">        Adapted from Fortran by Daryl Yentis NRL</span>
<span class="sd">        Converted to IDL V5.0   W. Landsman   September 1997</span>
<span class="sd">        Made J2000 the default, added /FK4 keyword  W. Landsman December 1998</span>
<span class="sd">        Add option to specify SELECT as a keyword W. Landsman March 2003</span>
<span class="sd">        Converted from IDL to numerical Python: Erin Sheldon, NYU, 2008-07-02</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Make a copy as an array. ndmin=1 to avoid messed up scalar arrays</span>
        <span class="n">ai</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ai_in</span><span class="p">,</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">bi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bi_in</span><span class="p">,</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>

        <span class="n">PI</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>
        <span class="c1"># HALFPI = PI / 2.0</span>
        <span class="n">D2R</span> <span class="o">=</span> <span class="n">PI</span> <span class="o">/</span> <span class="mf">180.0</span>
        <span class="n">R2D</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">D2R</span>

        <span class="n">twopi</span>   <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">PI</span>
        <span class="n">fourpi</span>  <span class="o">=</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">PI</span>

        <span class="c1">#   J2000 coordinate conversions are based on the following constants</span>
        <span class="c1">#   (see the Hipparcos explanatory supplement).</span>
        <span class="c1">#  eps = 23.4392911111d           Obliquity of the ecliptic</span>
        <span class="c1">#  alphaG = 192.85948d            Right Ascension of Galactic North Pole</span>
        <span class="c1">#  deltaG = 27.12825d             Declination of Galactic North Pole</span>
        <span class="c1">#  lomega = 32.93192d             Galactic longitude of celestial equator</span>
        <span class="c1">#  alphaE = 180.02322d            Ecliptic longitude of Galactic North Pole</span>
        <span class="c1">#  deltaE = 29.811438523d         Ecliptic latitude of Galactic North Pole</span>
        <span class="c1">#  Eomega  = 6.3839743d           Galactic longitude of ecliptic equator</span>
        <span class="c1"># Parameters for all the different conversions</span>
        <span class="k">if</span> <span class="n">b1950</span><span class="p">:</span>
            <span class="c1"># equinox = &#39;(B1950)&#39;</span>
            <span class="n">psi</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mf">0.57595865315</span><span class="p">,</span> <span class="mf">4.9261918136</span><span class="p">,</span>
                                <span class="mf">0.00000000000</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span>
                                <span class="mf">0.11129056012</span><span class="p">,</span> <span class="mf">4.7005372834</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
            <span class="n">stheta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mf">0.88781538514</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.88781538514</span><span class="p">,</span>
                                <span class="mf">0.39788119938</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.39788119938</span><span class="p">,</span>
                                <span class="mf">0.86766174755</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.86766174755</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
            <span class="n">ctheta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mf">0.46019978478</span><span class="p">,</span> <span class="mf">0.46019978478</span><span class="p">,</span>
                                <span class="mf">0.91743694670</span><span class="p">,</span> <span class="mf">0.91743694670</span><span class="p">,</span>
                                <span class="mf">0.49715499774</span><span class="p">,</span> <span class="mf">0.49715499774</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
            <span class="n">phi</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mf">4.9261918136</span><span class="p">,</span>  <span class="mf">0.57595865315</span><span class="p">,</span>
                                <span class="mf">0.0000000000</span><span class="p">,</span> <span class="mf">0.00000000000</span><span class="p">,</span>
                                <span class="mf">4.7005372834</span><span class="p">,</span> <span class="mf">0.11129056012</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># equinox = &#39;(J2000)&#39;</span>
            <span class="n">psi</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mf">0.57477043300</span><span class="p">,</span> <span class="mf">4.9368292465</span><span class="p">,</span>
                                <span class="mf">0.00000000000</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span>
                                <span class="mf">0.11142137093</span><span class="p">,</span> <span class="mf">4.71279419371</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
            <span class="n">stheta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mf">0.88998808748</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.88998808748</span><span class="p">,</span>
                                <span class="mf">0.39777715593</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.39777715593</span><span class="p">,</span>
                                <span class="mf">0.86766622025</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.86766622025</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
            <span class="n">ctheta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mf">0.45598377618</span><span class="p">,</span> <span class="mf">0.45598377618</span><span class="p">,</span>
                                <span class="mf">0.91748206207</span><span class="p">,</span> <span class="mf">0.91748206207</span><span class="p">,</span>
                                <span class="mf">0.49714719172</span><span class="p">,</span> <span class="mf">0.49714719172</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
            <span class="n">phi</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mf">4.9368292465</span><span class="p">,</span>  <span class="mf">0.57477043300</span><span class="p">,</span>
                                <span class="mf">0.0000000000</span><span class="p">,</span> <span class="mf">0.00000000000</span><span class="p">,</span>
                                <span class="mf">4.71279419371</span><span class="p">,</span> <span class="mf">0.11142137093</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>

        <span class="c1"># zero offset</span>
        <span class="n">i</span>  <span class="o">=</span> <span class="n">select</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">a</span>  <span class="o">=</span> <span class="n">ai</span> <span class="o">*</span> <span class="n">D2R</span> <span class="o">-</span> <span class="n">phi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">bi</span> <span class="o">*</span> <span class="n">D2R</span>
        <span class="n">sb</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="n">cbsa</span> <span class="o">=</span> <span class="n">cb</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="n">b</span>  <span class="o">=</span> <span class="o">-</span><span class="n">stheta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">cbsa</span> <span class="o">+</span> <span class="n">ctheta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">sb</span>
        <span class="n">w</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">b</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">w</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">b</span><span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">bo</span> <span class="o">=</span> <span class="n">arcsin</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">R2D</span>
        <span class="n">a</span>  <span class="o">=</span> <span class="n">arctan2</span><span class="p">(</span> <span class="n">ctheta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">cbsa</span> <span class="o">+</span> <span class="n">stheta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">sb</span><span class="p">,</span> <span class="n">cb</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">ao</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">psi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">fourpi</span><span class="p">)</span> <span class="o">%</span> <span class="n">twopi</span><span class="p">)</span> <span class="o">*</span> <span class="n">R2D</span>
        <span class="k">return</span> <span class="n">ao</span><span class="p">,</span> <span class="n">bo</span></div>

<div class="viewcode-block" id="AstroHelpers.sphdist"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.AstroHelpers.sphdist">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">sphdist</span><span class="p">(</span><span class="n">ra1</span><span class="p">,</span> <span class="n">dec1</span><span class="p">,</span> <span class="n">ra2</span><span class="p">,</span> <span class="n">dec2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;measures the spherical distance between 2 points</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ra1: float or sequence</span>
<span class="sd">            first right ascensions in degrees</span>

<span class="sd">        dec1: float or sequence</span>
<span class="sd">            first declination in degrees</span>
<span class="sd">        ra2: float or sequence</span>
<span class="sd">            second right ascensions in degrees</span>
<span class="sd">        dec2: float or sequence</span>
<span class="sd">            first declination in degrees</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Outputs: float or sequence</span>
<span class="sd">            returns a distance in degrees</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dec1_r</span> <span class="o">=</span> <span class="n">deg2rad</span><span class="p">(</span><span class="n">dec1</span><span class="p">)</span>
        <span class="n">dec2_r</span> <span class="o">=</span> <span class="n">deg2rad</span><span class="p">(</span><span class="n">dec2</span><span class="p">)</span>
        <span class="k">return</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">rad2deg</span><span class="p">(</span><span class="n">arcsin</span><span class="p">(</span><span class="n">sqrt</span><span class="p">((</span><span class="n">sin</span><span class="p">((</span><span class="n">dec1_r</span> <span class="o">-</span> <span class="n">dec2_r</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span>
                                        <span class="n">cos</span><span class="p">(</span><span class="n">dec1_r</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">dec2_r</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                                            <span class="n">sin</span><span class="p">((</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">ra1</span> <span class="o">-</span> <span class="n">ra2</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span> <span class="o">**</span>
                                        <span class="mi">2</span><span class="p">)))</span></div>

<div class="viewcode-block" id="AstroHelpers.conesearch"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.AstroHelpers.conesearch">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">conesearch</span><span class="p">(</span><span class="n">ra0</span><span class="p">,</span> <span class="n">dec0</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">outtype</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Perform a cone search on a table</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ra0: ndarray[ndim=1, dtype=float]</span>
<span class="sd">            column name to use as RA source in degrees</span>

<span class="sd">        dec0: ndarray[ndim=1, dtype=float]</span>
<span class="sd">            column name to use as DEC source in degrees</span>

<span class="sd">        ra: float</span>
<span class="sd">            ra to look for (in degree)</span>

<span class="sd">        dec: float</span>
<span class="sd">            ra to look for (in degree)</span>

<span class="sd">        r: float</span>
<span class="sd">            distance in degrees</span>

<span class="sd">        outtype: int</span>
<span class="sd">            type of outputs</span>
<span class="sd">                0 -- minimal, indices of matching coordinates</span>
<span class="sd">                1 -- indices and distances of matching coordinates</span>
<span class="sd">                2 -- full, boolean filter and distances</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        t: tuple</span>
<span class="sd">            if outtype is 0:</span>
<span class="sd">                only return indices from ra0, dec0</span>
<span class="sd">            elif outtype is 1:</span>
<span class="sd">                return indices from ra0, dec0 and distances</span>
<span class="sd">            elif outtype is 2:</span>
<span class="sd">                return conditional vector and distance to all ra0, dec0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nd">@elementwise</span>
        <span class="k">def</span> <span class="nf">getDist</span><span class="p">(</span> <span class="n">pk</span> <span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; get spherical distance between 2 points &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">AstroHelpers</span><span class="o">.</span><span class="n">sphdist</span><span class="p">(</span><span class="n">pk</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pk</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">)</span>

        <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">getDist</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">ra0</span><span class="p">,</span> <span class="n">dec0</span><span class="p">))))</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">dist</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">outtype</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">outtype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">v</span><span class="p">)),</span> <span class="n">dist</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">v</span><span class="p">,</span> <span class="n">dist</span></div></div>


<span class="c1"># ==============================================================================</span>
<span class="c1"># SimpleTable -- provides table manipulations with limited storage formats</span>
<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="SimpleTable"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.SimpleTable">[docs]</a><span class="k">class</span> <span class="nc">SimpleTable</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Table class that is designed to be the basis of any format wrapping</span>
<span class="sd">    around numpy recarrays</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    fname: str or object</span>
<span class="sd">        if str, the file to read from. This may be limited to the format</span>
<span class="sd">        currently handled automatically. If the format is not correctly handled,</span>
<span class="sd">        you can try by providing an object.__</span>

<span class="sd">        if object with a structure like dict, ndarray, or recarray-like</span>
<span class="sd">            the data will be encapsulated into a Table</span>

<span class="sd">    caseless: bool</span>
<span class="sd">        if set, column names will be caseless during operations</span>

<span class="sd">    aliases: dict</span>
<span class="sd">        set of column aliases (can be defined later :func:`set_alias`)</span>

<span class="sd">    units: dict</span>
<span class="sd">        set of column units (can be defined later :func:`set_unit`)</span>

<span class="sd">    desc: dict</span>
<span class="sd">        set of column description or comments (can be defined later :func:`set_comment`)</span>

<span class="sd">    header: dict</span>
<span class="sd">        key, value pair corresponding to the attributes of the table</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">dtype</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;dtype&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">caseless</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;caseless&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_aliases</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;aliases&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_units</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_desc</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;desc&#39;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">GeneratorType</span><span class="p">)))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">dtype</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="s1">&#39;dict&#39;</span><span class="p">]):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">fname</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;header&#39;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;header&#39;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">_convert_dict_to_structured_ndarray</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">str</span><span class="p">,))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">str</span><span class="p">,)):</span>
                <span class="n">extension</span> <span class="o">=</span> <span class="n">fname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">extension</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">extension</span> <span class="o">==</span> <span class="s1">&#39;csv&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;csv&#39;</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;delimiter&#39;</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span>
                <span class="n">commentedHeader</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;commentedHeader&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="n">n</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">comments</span><span class="p">,</span> <span class="n">aliases</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="n">_ascii_read_header</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">commentedHeader</span><span class="o">=</span><span class="n">commentedHeader</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;names&#39;</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">_pd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>   <span class="c1"># pandas is faster</span>
                    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;comment&#39;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">)</span>
                    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;as_recarray&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;skiprows&#39;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">_pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;skip_header&#39;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
                    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">recfromcsv</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">header</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">units</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_desc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">comments</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_aliases</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">aliases</span><span class="p">)</span>
                <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;names&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">extension</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;tsv&#39;</span><span class="p">,</span> <span class="s1">&#39;dat&#39;</span><span class="p">,</span> <span class="s1">&#39;txt&#39;</span><span class="p">))</span> <span class="ow">or</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;tsv&#39;</span><span class="p">,</span> <span class="s1">&#39;dat&#39;</span><span class="p">,</span> <span class="s1">&#39;txt&#39;</span><span class="p">):</span>
                <span class="n">commentedHeader</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;commentedHeader&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                <span class="n">n</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">comments</span><span class="p">,</span> <span class="n">aliases</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="n">_ascii_read_header</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">commentedHeader</span><span class="o">=</span><span class="n">commentedHeader</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;names&#39;</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">_pd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>   <span class="c1"># pandas is faster</span>
                    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;delimiter&#39;</span><span class="p">,</span> <span class="s1">&#39;\s+&#39;</span><span class="p">)</span>
                    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;comment&#39;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">)</span>
                    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;as_recarray&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">_pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;delimiter&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">)</span>
                    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;skip_header&#39;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">recfromtxt</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">header</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">units</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_desc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">comments</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_aliases</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">aliases</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">extension</span> <span class="o">==</span> <span class="s1">&#39;fits&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;fits&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pyfits</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Cannot read this format, Astropy or pyfits not found&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;extname&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;ext&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pyfits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
                <span class="n">header</span><span class="p">,</span> <span class="n">aliases</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="n">_fits_read_header</span><span class="p">(</span><span class="n">pyfits</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">header</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_desc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">comments</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">units</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_aliases</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">aliases</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">extension</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;hdf5&#39;</span><span class="p">,</span> <span class="s1">&#39;hd5&#39;</span><span class="p">,</span> <span class="s1">&#39;hdf&#39;</span><span class="p">))</span> <span class="ow">or</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="p">(</span><span class="n">extension</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;hdf5&#39;</span><span class="p">,</span> <span class="s1">&#39;hd5&#39;</span><span class="p">,</span> <span class="s1">&#39;hdf&#39;</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">tables</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Cannot read this format, pytables not found&#39;</span><span class="p">)</span>
                <span class="n">hdr</span><span class="p">,</span> <span class="n">aliases</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">_hdf5_read_data</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">hdr</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">units</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_desc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">desc</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_aliases</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">aliases</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Format </span><span class="si">{0:s}</span><span class="s1"> not handled&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">extension</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">fname</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="o">==</span> <span class="n">pyfits</span><span class="o">.</span><span class="n">FITS_rec</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="o">==</span> <span class="n">SimpleTable</span><span class="p">:</span>
            <span class="n">cp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;copy&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cp</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">fname</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">fname</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_aliases</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">fname</span><span class="o">.</span><span class="n">_aliases</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_units</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">fname</span><span class="o">.</span><span class="n">_units</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_desc</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">fname</span><span class="o">.</span><span class="n">_desc</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">fname</span><span class="o">.</span><span class="n">data</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">fname</span><span class="o">.</span><span class="n">header</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_aliases</span> <span class="o">=</span> <span class="n">fname</span><span class="o">.</span><span class="n">_aliases</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_units</span> <span class="o">=</span> <span class="n">fname</span><span class="o">.</span><span class="n">_units</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_desc</span> <span class="o">=</span> <span class="n">fname</span><span class="o">.</span><span class="n">_desc</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;dtype&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Type </span><span class="si">{0!s:s}</span><span class="s1"> not handled&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">fname</span><span class="p">)))</span>
        <span class="k">if</span> <span class="s1">&#39;NAME&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">basestring</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;No Name&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fname</span>

<div class="viewcode-block" id="SimpleTable.pprint_entry"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.SimpleTable.pprint_entry">[docs]</a>    <span class="k">def</span> <span class="nf">pprint_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; print one line with key and values properly to be readable</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        num: int, slice</span>
<span class="sd">            indice selection</span>

<span class="sd">        keys: sequence or str</span>
<span class="sd">            if str, can be a regular expression</span>
<span class="sd">            if sequence, the sequence of keys to print</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">keys</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">keys</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">):</span>
            <span class="n">_keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="ow">in</span> <span class="n">basestring</span><span class="p">:</span>
            <span class="n">_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_aliases</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                     <span class="k">if</span> <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_keys</span> <span class="o">=</span> <span class="n">keys</span>

        <span class="n">length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">_keys</span><span class="p">))</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;{{0:</span><span class="si">{0:d}</span><span class="s1">s}}: {{1}}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">num</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">_keys</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">resolve_alias</span><span class="p">(</span><span class="n">k</span><span class="p">)]))</span></div>

<div class="viewcode-block" id="SimpleTable.pprint"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.SimpleTable.pprint">[docs]</a>    <span class="k">def</span> <span class="nf">pprint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ret</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">full_match</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">headerChar</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">delim</span><span class="o">=</span><span class="s1">&#39; | &#39;</span><span class="p">,</span> <span class="n">endline</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
               <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Pretty print the table content</span>
<span class="sd">            you can select the table parts to display using idx to</span>
<span class="sd">            select the rows and fields to only display some columns</span>
<span class="sd">            (ret is only for insternal use)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        idx: sequence, slide</span>
<span class="sd">            sub selection to print</span>

<span class="sd">        fields: str, sequence</span>
<span class="sd">            if str can be a regular expression, and/or list of fields separated</span>
<span class="sd">            by spaces or commas</span>

<span class="sd">        ret: bool</span>
<span class="sd">            if set return the string representation instead of printing the result</span>

<span class="sd">        all: bool</span>
<span class="sd">            if set, force to show all rows</span>

<span class="sd">        headerChar: char</span>
<span class="sd">            Character to be used for the row separator line</span>

<span class="sd">        delim: char</span>
<span class="sd">            The column delimiter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">full_match</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">fullmatch</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">fields</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">fields</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">):</span>
            <span class="n">_keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span> <span class="ow">in</span> <span class="n">basestring</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;,&#39;</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                <span class="n">_fields</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s1">&#39; &#39;</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                <span class="n">_fields</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">fields</span><span class="p">]</span>
            <span class="n">lbls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_aliases</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">_keys</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">_fk</span> <span class="ow">in</span> <span class="n">_fields</span><span class="p">:</span>
                <span class="n">_keys</span> <span class="o">+=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">lbls</span> <span class="k">if</span> <span class="p">(</span><span class="n">fn</span><span class="p">(</span><span class="n">_fk</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lbls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_aliases</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">_keys</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">_fk</span> <span class="ow">in</span> <span class="n">_fields</span><span class="p">:</span>
                <span class="n">_keys</span> <span class="o">+=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">lbls</span> <span class="k">if</span> <span class="p">(</span><span class="n">fn</span><span class="p">(</span><span class="n">_fk</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)]</span>

        <span class="n">nfields</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">_keys</span><span class="p">)</span>

        <span class="n">fields</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_alias</span><span class="p">,</span> <span class="n">_keys</span> <span class="p">))</span>

        <span class="k">if</span> <span class="n">idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrows</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">all</span><span class="p">:</span>
                <span class="n">rows</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">rk</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">_keys</span> <span class="p">]</span> <span class="k">for</span> <span class="n">rk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrows</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_idx</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
                <span class="n">rows</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">rk</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">_keys</span> <span class="p">]</span> <span class="k">for</span> <span class="n">rk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="p">]</span>
                <span class="k">if</span> <span class="n">nfields</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">rows</span> <span class="o">+=</span> <span class="p">[</span> <span class="p">[</span><span class="s1">&#39;...&#39;</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nfields</span><span class="p">)</span> <span class="p">]</span> <span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rows</span> <span class="o">+=</span> <span class="p">[</span> <span class="p">[</span><span class="s1">&#39;...&#39;</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nfields</span><span class="p">)</span> <span class="p">]</span> <span class="p">]</span>
                <span class="n">rows</span> <span class="o">+=</span> <span class="p">[</span> <span class="p">[</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">rk</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">fields</span> <span class="p">]</span> <span class="k">for</span> <span class="n">rk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="n">_idx</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">idx</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span> <span class="n">idx</span><span class="o">.</span><span class="n">step</span> <span class="ow">or</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">rk</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">fields</span> <span class="p">]</span> <span class="k">for</span> <span class="n">rk</span> <span class="ow">in</span> <span class="n">_idx</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">rk</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">fields</span> <span class="p">]</span> <span class="k">for</span> <span class="n">rk</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">units</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">units</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">fields</span> <span class="p">]</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">__indent__</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">_keys</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span> <span class="n">delim</span><span class="o">=</span><span class="n">delim</span><span class="p">,</span>
                         <span class="n">headerChar</span><span class="o">=</span><span class="n">headerChar</span><span class="p">,</span> <span class="n">endline</span><span class="o">=</span><span class="n">endline</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ret</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">out</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span></div>

<div class="viewcode-block" id="SimpleTable.write"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.SimpleTable.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; write table into file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fname: str</span>
<span class="sd">            filename to export the table into</span>

<span class="sd">        .. note::</span>
<span class="sd">            additional keywords are forwarded to the corresponding libraries</span>
<span class="sd">            :func:`pyfits.writeto` or :func:`pyfits.append`</span>
<span class="sd">            :func:`np.savetxt`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">extension</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;extension&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">extension</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">extension</span> <span class="o">=</span> <span class="n">fname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">extension</span> <span class="o">==</span> <span class="s1">&#39;csv&#39;</span><span class="p">):</span>
            <span class="n">comments</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">)</span>
            <span class="n">delimiter</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;delimiter&#39;</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span>
            <span class="n">commentedHeader</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;commentedHeader&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">hdr</span> <span class="o">=</span> <span class="n">_ascii_generate_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="n">comments</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span>
                                         <span class="n">commentedHeader</span><span class="o">=</span><span class="n">commentedHeader</span><span class="p">)</span>
            <span class="n">header</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;header&#39;</span><span class="p">,</span> <span class="n">hdr</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">,</span>
                       <span class="n">comments</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">extension</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;txt&#39;</span><span class="p">,</span> <span class="s1">&#39;dat&#39;</span><span class="p">]):</span>
            <span class="n">comments</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">)</span>
            <span class="n">delimiter</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;delimiter&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">commentedHeader</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;commentedHeader&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">hdr</span> <span class="o">=</span> <span class="n">_ascii_generate_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="n">comments</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span>
                                         <span class="n">commentedHeader</span><span class="o">=</span><span class="n">commentedHeader</span><span class="p">)</span>
            <span class="n">header</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;header&#39;</span><span class="p">,</span> <span class="n">hdr</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">,</span>
                       <span class="n">comments</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">extension</span> <span class="o">==</span> <span class="s1">&#39;fits&#39;</span><span class="p">):</span>
            <span class="n">hdr0</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;header&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">append</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;append&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">hdr</span> <span class="o">=</span> <span class="n">_fits_generate_header</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">hdr0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">hdr</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">hdr0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">append</span><span class="p">:</span>
                <span class="n">_fits_append</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">hdr</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># patched version to correctly include the header</span>
                <span class="n">_fits_writeto</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">hdr</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">extension</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;hdf&#39;</span><span class="p">,</span> <span class="s1">&#39;hdf5&#39;</span><span class="p">,</span> <span class="s1">&#39;hd5&#39;</span><span class="p">)):</span>
            <span class="n">_hdf5_write_data</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">,</span>
                             <span class="n">units</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_desc</span><span class="p">,</span>
                             <span class="n">aliases</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_aliases</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Format </span><span class="si">{0:s}</span><span class="s1"> not handled&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">extension</span><span class="p">))</span></div>

<div class="viewcode-block" id="SimpleTable.set_alias"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.SimpleTable.set_alias">[docs]</a>    <span class="k">def</span> <span class="nf">set_alias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alias</span><span class="p">,</span> <span class="n">colname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define an alias to a column</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        alias: str</span>
<span class="sd">            The new alias of the column</span>

<span class="sd">        colname: str</span>
<span class="sd">            The column being aliased</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">colname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Column </span><span class="si">{0:s}</span><span class="s2"> does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">colname</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_aliases</span><span class="p">[</span><span class="n">alias</span><span class="p">]</span> <span class="o">=</span> <span class="n">colname</span></div>

<div class="viewcode-block" id="SimpleTable.reverse_alias"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.SimpleTable.reverse_alias">[docs]</a>    <span class="k">def</span> <span class="nf">reverse_alias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return aliases of a given column.</span>

<span class="sd">        Given a colname, return a sequence of aliases associated to this column</span>
<span class="sd">        Aliases are defined by using .define_alias()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_colname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_alias</span><span class="p">(</span><span class="n">colname</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_colname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Column </span><span class="si">{0:s}</span><span class="s2"> does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">colname</span><span class="p">))</span>

        <span class="k">return</span> <span class="nb">tuple</span><span class="p">([</span> <span class="n">k</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aliases</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">==</span> <span class="n">_colname</span><span class="p">)</span> <span class="p">])</span></div>

<div class="viewcode-block" id="SimpleTable.resolve_alias"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.SimpleTable.resolve_alias">[docs]</a>    <span class="k">def</span> <span class="nf">resolve_alias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the name of an aliased column.</span>

<span class="sd">        Given an alias, return the column name it aliases. This</span>
<span class="sd">        function is a no-op if the alias is a column name itself.</span>

<span class="sd">        Aliases are defined by using .define_alias()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># User aliases</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">colname</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">colname</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_alias</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">colname</span> <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">caseless</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">maps</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="p">[</span> <span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aliases</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">]</span> <span class="p">)</span>
                <span class="n">maps</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span>
                <span class="k">return</span> <span class="n">maps</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">colname</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">colname</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aliases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">colname</span><span class="p">,</span> <span class="n">colname</span><span class="p">)</span></div>

<div class="viewcode-block" id="SimpleTable.set_unit"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.SimpleTable.set_unit">[docs]</a>    <span class="k">def</span> <span class="nf">set_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colname</span><span class="p">,</span> <span class="n">unit</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the unit of a column referenced by its name</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        colname: str</span>
<span class="sd">            column name or registered alias</span>

<span class="sd">        unit: str</span>
<span class="sd">            unit description</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">basestring</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">colname</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">resolve_alias</span><span class="p">(</span><span class="n">colname</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">colname</span><span class="p">,</span> <span class="n">unit</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">resolve_alias</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></div>

<div class="viewcode-block" id="SimpleTable.set_comment"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.SimpleTable.set_comment">[docs]</a>    <span class="k">def</span> <span class="nf">set_comment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colname</span><span class="p">,</span> <span class="n">comment</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the comment of a column referenced by its name</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        colname: str</span>
<span class="sd">            column name or registered alias</span>

<span class="sd">        comment: str</span>
<span class="sd">            column description</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">comment</span><span class="p">,</span> <span class="n">basestring</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">colname</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_desc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">resolve_alias</span><span class="p">(</span><span class="n">colname</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">comment</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">colname</span><span class="p">,</span> <span class="n">comment</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_desc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">resolve_alias</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></div>

<div class="viewcode-block" id="SimpleTable.keys"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.SimpleTable.keys">[docs]</a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">regexp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">full_match</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the data column names or a subset of it</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        regexp: str</span>
<span class="sd">            pattern to filter the keys with</span>

<span class="sd">        full_match: bool</span>
<span class="sd">            if set, use :func:`re.fullmatch` instead of :func:`re.match`</span>

<span class="sd">        Try to apply the pattern at the start of the string, returning</span>
<span class="sd">        a match object, or None if no match was found.</span>

<span class="sd">        returns</span>
<span class="sd">        -------</span>
<span class="sd">        seq: sequence</span>
<span class="sd">            sequence of keys</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">regexp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">regexp</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">regexp</span><span class="p">)</span> <span class="ow">in</span> <span class="n">basestring</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">full_match</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">fn</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">fullmatch</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fn</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span>

            <span class="k">if</span> <span class="n">regexp</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">_re</span> <span class="o">=</span> <span class="n">regexp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">regexp</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">_re</span> <span class="o">=</span> <span class="n">regexp</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_re</span> <span class="o">=</span> <span class="p">[</span><span class="n">regexp</span><span class="p">]</span>

            <span class="n">lbls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_aliases</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">_keys</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">_rk</span> <span class="ow">in</span> <span class="n">_re</span><span class="p">:</span>
                <span class="n">_keys</span> <span class="o">+=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">lbls</span> <span class="k">if</span> <span class="p">(</span><span class="n">fn</span><span class="p">(</span><span class="n">_rk</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)]</span>

            <span class="k">return</span> <span class="n">_keys</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">regexp</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">):</span>
            <span class="n">_keys</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">regexp</span><span class="p">:</span>
                <span class="n">_keys</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_keys</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unexpected type </span><span class="si">{0}</span><span class="s1"> for regexp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">regexp</span><span class="p">)))</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; name of the table given by the Header[&#39;NAME&#39;] attribute &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NAME&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">colnames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sequence of column names &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ncols</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; number of columns &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nrows</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; number of lines &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nbytes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; number of bytes of the object &quot;&quot;&quot;</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">nbytes</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;nbytes&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">sys</span><span class="o">.</span><span class="n">getsizeof</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">n</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; number of lines &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrows</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; shape of the data &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; dtype of the data &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resolve_alias</span><span class="p">(</span><span class="n">v</span><span class="p">)))</span>

<div class="viewcode-block" id="SimpleTable.get"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.SimpleTable.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">full_match</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns a table from columns given as v</span>

<span class="sd">        this function is equivalent to :func:`__getitem__` but preserve the</span>
<span class="sd">        Table format and associated properties (units, description, header)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        v: str</span>
<span class="sd">            pattern to filter the keys with</span>

<span class="sd">        full_match: bool</span>
<span class="sd">            if set, use :func:`re.fullmatch` instead of :func:`re.match`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">new_keys</span><span class="p">])</span>
        <span class="n">t</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">_aliases</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aliases</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">new_keys</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">_units</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">new_keys</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">_desc</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desc</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">new_keys</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">t</span></div>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resolve_alias</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">object</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resolve_alias</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">newtab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="n">newtab</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>
            <span class="k">yield</span> <span class="n">newtab</span>
        <span class="c1"># return self.data.__iter__()</span>

<div class="viewcode-block" id="SimpleTable.iterkeys"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.SimpleTable.iterkeys">[docs]</a>    <span class="k">def</span> <span class="nf">iterkeys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Iterator over the columns of the table &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">k</span></div>

<div class="viewcode-block" id="SimpleTable.itervalues"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.SimpleTable.itervalues">[docs]</a>    <span class="k">def</span> <span class="nf">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Iterator over the lines of the table &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">l</span></div>

<div class="viewcode-block" id="SimpleTable.info"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.SimpleTable.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Table: </span><span class="si">{name:s}</span><span class="se">\n</span><span class="s2">       nrows=</span><span class="si">{s.nrows:d}</span><span class="s2">, ncols=</span><span class="si">{s.ncols:d}</span><span class="s2">, mem=</span><span class="si">{size:s}</span><span class="s2">&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NAME&#39;</span><span class="p">,</span> <span class="s1">&#39;Noname&#39;</span><span class="p">),</span> <span class="n">s</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">size</span><span class="o">=</span><span class="n">pretty_size_print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nbytes</span><span class="p">))</span>

        <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">Header:</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">{{0:</span><span class="si">{0:d}</span><span class="s1">s}} {{1}}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

        <span class="n">vals</span> <span class="o">=</span> <span class="p">[(</span><span class="n">k</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">]</span>
        <span class="n">lengths</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_desc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)))</span>
                   <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">]</span>
        <span class="n">lengths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">max</span><span class="p">,</span> <span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">lengths</span><span class="p">))))</span>

        <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Columns:</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">{{0:</span><span class="si">{0:d}</span><span class="s1">s}} {{1:</span><span class="si">{1:d}</span><span class="s1">s}} {{2:</span><span class="si">{2:d}</span><span class="s1">s}}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">lengths</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_aliases</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Table contains alias(es):&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aliases</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="si">{0:s}</span><span class="s1"> --&gt; </span><span class="si">{1:s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Table: </span><span class="si">{name:s}</span><span class="se">\n</span><span class="s2">       nrows=</span><span class="si">{s.nrows:d}</span><span class="s2">, ncols=</span><span class="si">{s.ncols:d}</span><span class="s2">, mem=</span><span class="si">{size:s}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NAME&#39;</span><span class="p">,</span> <span class="s1">&#39;Noname&#39;</span><span class="p">),</span> <span class="n">s</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">size</span><span class="o">=</span><span class="n">pretty_size_print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nbytes</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__getslice__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">__getslice__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aliases</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__array__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evalexpr</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>

<div class="viewcode-block" id="SimpleTable.sort"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.SimpleTable.sort">[docs]</a>    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sort the table inplace according to one or more keys. This operates on</span>
<span class="sd">        the existing table (and does not return a new table).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        keys: str or seq(str)</span>
<span class="sd">            The key(s) to order by</span>

<span class="sd">        copy: bool</span>
<span class="sd">            if set returns a sorted copy instead of working inplace</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">):</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">keys</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">copy</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="n">keys</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">t</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span></div>

<div class="viewcode-block" id="SimpleTable.match"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.SimpleTable.match">[docs]</a>    <span class="k">def</span> <span class="nf">match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the indices at which the tables match</span>
<span class="sd">        matching uses 2 columns that are compared in values</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        r2:  Table</span>
<span class="sd">            second table to use</span>

<span class="sd">        key: str</span>
<span class="sd">            fields used for comparison.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        indexes: tuple</span>
<span class="sd">            tuple of both indices list where the two columns match.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">r2</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span></div>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    def stack(self, r, defaults=None):</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        Superposes arrays fields by fields inplace</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        r: Table</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        if not hasattr(r, &#39;data&#39;):</span>
<span class="sd">            raise AttributeError(&#39;r should be a Table object&#39;)</span>
<span class="sd">        self.data = recfunctions.stack_arrays([self.data, r.data], defaults,</span>
<span class="sd">                                              usemask=False, asrecarray=True)</span>
<span class="sd">    &#39;&#39;&#39;</span>

<div class="viewcode-block" id="SimpleTable.stack"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.SimpleTable.stack">[docs]</a>    <span class="k">def</span> <span class="nf">stack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Superposes arrays fields by fields inplace</span>

<span class="sd">        t.stack(t1, t2, t3, default=None, inplace=True)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        r: Table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;r should be a Table object&#39;</span><span class="p">)</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;defaults&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">inplace</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;inplace&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">data</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">data</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">args</span><span class="p">]</span>
        <span class="n">sdata</span> <span class="o">=</span> <span class="n">recfunctions</span><span class="o">.</span><span class="n">stack_arrays</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">defaults</span><span class="p">,</span> <span class="n">usemask</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                          <span class="n">asrecarray</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">sdata</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">t</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">sdata</span>
            <span class="k">return</span> <span class="n">t</span></div>

<div class="viewcode-block" id="SimpleTable.join_by"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.SimpleTable.join_by">[docs]</a>    <span class="k">def</span> <span class="nf">join_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">jointype</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">r1postfix</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="n">r2postfix</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span>
                <span class="n">defaults</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">asrecarray</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">asTable</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Join arrays `r1` and `r2` on key `key`.</span>

<span class="sd">        The key should be either a string or a sequence of string corresponding</span>
<span class="sd">        to the fields used to join the array.</span>
<span class="sd">        An exception is raised if the `key` field cannot be found in the two input</span>
<span class="sd">        arrays.</span>
<span class="sd">        Neither `r1` nor `r2` should have any duplicates along `key`: the presence</span>
<span class="sd">        of duplicates will make the output quite unreliable. Note that duplicates</span>
<span class="sd">        are not looked for by the algorithm.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key: str or seq(str)</span>
<span class="sd">            corresponding to the fields used for comparison.</span>

<span class="sd">        r2: Table</span>
<span class="sd">            Table to join with</span>

<span class="sd">        jointype: str in {&#39;inner&#39;, &#39;outer&#39;, &#39;leftouter&#39;}</span>
<span class="sd">            * &#39;inner&#39;     : returns the elements common to both r1 and r2.</span>
<span class="sd">            * &#39;outer&#39;     : returns the common elements as well as the elements of r1 not in r2 and the elements of not in r2.</span>
<span class="sd">            * &#39;leftouter&#39; : returns the common elements and the elements of r1 not in r2.</span>

<span class="sd">        r1postfix: str</span>
<span class="sd">            String appended to the names of the fields of r1 that are present in r2</span>

<span class="sd">        r2postfix:  str</span>
<span class="sd">            String appended to the names of the fields of r2 that are present in r1</span>

<span class="sd">        defaults:   dict</span>
<span class="sd">            Dictionary mapping field names to the corresponding default values.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tab: Table</span>
<span class="sd">            joined table</span>

<span class="sd">        .. note::</span>

<span class="sd">            * The output is sorted along the key.</span>

<span class="sd">            * A temporary array is formed by dropping the fields not in the key</span>
<span class="sd">              for the two arrays and concatenating the result. This array is</span>
<span class="sd">              then sorted, and the common entries selected. The output is</span>
<span class="sd">              constructed by filling the fields with the selected entries.</span>
<span class="sd">              Matching is not preserved if there are some duplicates...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">recfunctions</span><span class="o">.</span><span class="n">join_by</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">r2</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">jointype</span><span class="o">=</span><span class="n">jointype</span><span class="p">,</span>
                                   <span class="n">r1postfix</span><span class="o">=</span><span class="n">r1postfix</span><span class="p">,</span> <span class="n">r2postfix</span><span class="o">=</span><span class="n">r2postfix</span><span class="p">,</span>
                                   <span class="n">defaults</span><span class="o">=</span><span class="n">defaults</span><span class="p">,</span> <span class="n">usemask</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                   <span class="n">asrecarray</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">SimpleTable</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">empty_row</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return an empty row array respecting the table format &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">rec</span><span class="o">.</span><span class="n">recarray</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

<div class="viewcode-block" id="SimpleTable.add_column"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.SimpleTable.add_column">[docs]</a>    <span class="k">def</span> <span class="nf">add_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add one or multiple columns to the table</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name: str or sequence(str)</span>
<span class="sd">           The name(s) of the column(s) to add</span>

<span class="sd">        data: ndarray, or sequence of ndarray</span>
<span class="sd">            The column data, or sequence of columns</span>

<span class="sd">        dtype: dtype</span>
<span class="sd">            numpy dtype for the data to add</span>

<span class="sd">        unit: str</span>
<span class="sd">            The unit of the values in the column</span>

<span class="sd">        description: str</span>
<span class="sd">            A description of the content of the column</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">_data</span><span class="o">.</span><span class="n">dtype</span>

        <span class="c1"># unknown type is converted to text</span>
        <span class="k">if</span> <span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">object_</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">longest</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">longest</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">))</span>
                <span class="n">_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;|</span><span class="si">%i</span><span class="s1">S&#39;</span> <span class="o">%</span> <span class="n">longest</span><span class="p">)</span>

        <span class="n">dtype</span> <span class="o">=</span> <span class="n">_data</span><span class="o">.</span><span class="n">dtype</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># existing data in the table</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">recfunctions</span><span class="o">.</span><span class="n">append_fields</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">_data</span><span class="p">,</span>
                                                   <span class="n">dtypes</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">usemask</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                   <span class="n">asrecarray</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">newdtype</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">_data</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="p">(</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">newdtype</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">_data</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">_data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[</span><span class="n">newdtype</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_unit</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_unit</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span></div>

<div class="viewcode-block" id="SimpleTable.append_row"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.SimpleTable.append_row">[docs]</a>    <span class="k">def</span> <span class="nf">append_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Append one row in this table.</span>

<span class="sd">        see also: :func:`stack`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        iterable: iterable</span>
<span class="sd">            line to add</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncols</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Expecting as many items as columns&#39;</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">empty_row</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">iterable</span><span class="p">):</span>
            <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">r</span><span class="p">)</span></div>

<div class="viewcode-block" id="SimpleTable.remove_columns"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.SimpleTable.remove_columns">[docs]</a>    <span class="k">def</span> <span class="nf">remove_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove several columns from the table</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        names: sequence</span>
<span class="sd">            A list containing the names of the columns to remove</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_columns</span><span class="p">(</span><span class="n">names</span><span class="p">)</span></div>

<div class="viewcode-block" id="SimpleTable.pop_columns"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.SimpleTable.pop_columns">[docs]</a>    <span class="k">def</span> <span class="nf">pop_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pop several columns from the table</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        names: sequence</span>
<span class="sd">            A list containing the names of the columns to remove</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        values: tuple</span>
<span class="sd">            list of columns</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="ow">in</span> <span class="n">basestring</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">names</span><span class="p">]</span>

        <span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span>

        <span class="n">_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_alias</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">names</span> <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">recfunctions</span><span class="o">.</span><span class="n">drop_fields</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">_names</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_aliases</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_desc</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">p</span></div>

<div class="viewcode-block" id="SimpleTable.find_duplicate"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.SimpleTable.find_duplicate">[docs]</a>    <span class="k">def</span> <span class="nf">find_duplicate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">values_only</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find duplication in the table entries, return a list of duplicated</span>
<span class="sd">        elements Only works at this time is 2 lines are *the same entry* not if</span>
<span class="sd">        2 lines have *the same values*</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dup</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">idd</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)):</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]):</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dup</span><span class="p">):</span>
                    <span class="n">dup</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">idd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">index_only</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">idd</span>
        <span class="k">elif</span> <span class="n">values_only</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dup</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">zip</span><span class="p">(</span><span class="n">idd</span><span class="p">,</span> <span class="n">dup</span><span class="p">)</span></div>

<div class="viewcode-block" id="SimpleTable.evalexpr"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.SimpleTable.evalexpr">[docs]</a>    <span class="k">def</span> <span class="nf">evalexpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exprvars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; evaluate expression based on the data and external variables</span>
<span class="sd">            all np function can be used (log, exp, pi...)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        expr: str</span>
<span class="sd">            expression to evaluate on the table</span>
<span class="sd">            includes mathematical operations and attribute names</span>

<span class="sd">        exprvars: dictionary, optional</span>
<span class="sd">            A dictionary that replaces the local operands in current frame.</span>

<span class="sd">        dtype: dtype definition</span>
<span class="sd">            dtype of the output array</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out : NumPy array</span>
<span class="sd">            array of the result</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_globals</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_aliases</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="p">):</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">expr</span><span class="p">:</span>
                <span class="n">_globals</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">exprvars</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">exprvars</span><span class="p">,</span> <span class="s1">&#39;keys&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">exprvars</span><span class="p">,</span> <span class="s1">&#39;__getitem__&#39;</span> <span class="p">))):</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Expecting a dictionary-like as condvars&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">(</span> <span class="n">exprvars</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">):</span>
                <span class="n">_globals</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

        <span class="c1"># evaluate expression, to obtain the final filter</span>
        <span class="n">r</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrows</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">r</span><span class="p">[:]</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">_globals</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">r</span></div>

<div class="viewcode-block" id="SimpleTable.where"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.SimpleTable.where">[docs]</a>    <span class="k">def</span> <span class="nf">where</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">condition</span><span class="p">,</span> <span class="n">condvars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Read table data fulfilling the given `condition`.</span>
<span class="sd">        Only the rows fulfilling the `condition` are included in the result.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        condition: str</span>
<span class="sd">            expression to evaluate on the table</span>
<span class="sd">            includes mathematical operations and attribute names</span>

<span class="sd">        condvars: dictionary, optional</span>
<span class="sd">            A dictionary that replaces the local operands in current frame.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out: ndarray/ tuple of ndarrays</span>
<span class="sd">        result equivalent to :func:`np.where`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evalexpr</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="n">condvars</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span> <span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ind</span></div>

<div class="viewcode-block" id="SimpleTable.select"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.SimpleTable.select">[docs]</a>    <span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select only a few fields in the table</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fields: str or sequence</span>
<span class="sd">            fields to keep in the resulting table</span>

<span class="sd">        indices: sequence or slice</span>
<span class="sd">            extract only on these indices</span>

<span class="sd">        returns</span>
<span class="sd">        -------</span>
<span class="sd">        tab: SimpleTable instance</span>
<span class="sd">            resulting table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fields</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">indices</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="p">):</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
                <span class="k">return</span> <span class="n">tab</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">_fields</span><span class="p">:</span>
                <span class="n">_k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_alias</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">_k</span><span class="p">][</span><span class="n">indices</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">_k</span><span class="p">]</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;header&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>
            <span class="n">tab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="p">):</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
            <span class="k">return</span> <span class="n">tab</span></div>

<div class="viewcode-block" id="SimpleTable.selectWhere"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.SimpleTable.selectWhere">[docs]</a>    <span class="k">def</span> <span class="nf">selectWhere</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">condition</span><span class="p">,</span> <span class="n">condvars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Read table data fulfilling the given `condition`.</span>
<span class="sd">            Only the rows fulfilling the `condition` are included in the result.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fields: str or sequence</span>
<span class="sd">            fields to keep in the resulting table</span>

<span class="sd">        condition: str</span>
<span class="sd">            expression to evaluate on the table</span>
<span class="sd">            includes mathematical operations and attribute names</span>

<span class="sd">        condvars: dictionary, optional</span>
<span class="sd">            A dictionary that replaces the local operands in current frame.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tab: SimpleTable instance</span>
<span class="sd">            resulting table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">condition</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;True&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="n">condvars</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">tab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">ind</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">tab</span></div>

<div class="viewcode-block" id="SimpleTable.groupby"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.SimpleTable.groupby">[docs]</a>    <span class="k">def</span> <span class="nf">groupby</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create an iterator which returns (key, sub-table) grouped by each value</span>
<span class="sd">        of key(value)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key: str</span>
<span class="sd">            expression or pattern to filter the keys with</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        key: str or sequence</span>
<span class="sd">            group key</span>

<span class="sd">        tab: SimpleTable instance</span>
<span class="sd">           sub-table of the group</span>
<span class="sd">           header, aliases and column metadata are preserved (linked to the</span>
<span class="sd">           master table).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">getter</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="o">*</span><span class="n">_key</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">grp</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">getter</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span><span class="n">grp</span><span class="p">))</span>
            <span class="n">t</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span>
            <span class="n">t</span><span class="o">.</span><span class="n">_aliases</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aliases</span>
            <span class="n">t</span><span class="o">.</span><span class="n">_units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span>
            <span class="n">t</span><span class="o">.</span><span class="n">_desc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desc</span>
            <span class="k">yield</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span></div>

<div class="viewcode-block" id="SimpleTable.stats"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.SimpleTable.stats">[docs]</a>    <span class="k">def</span> <span class="nf">stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Make statistics on columns of a table</span>

<span class="sd">        Paramters</span>
<span class="sd">        ---------</span>
<span class="sd">        fn: callable or sequence of callables</span>
<span class="sd">            functions to apply to each column</span>
<span class="sd">            default: (np.mean, np.std, np.nanmin, np.nanmax)</span>

<span class="sd">        fields: str or sequence</span>
<span class="sd">            any key or key expression to subselect columns</span>
<span class="sd">            default is all columns</span>

<span class="sd">        fill: value</span>
<span class="sd">            value when not applicable</span>
<span class="sd">            default np.nan</span>

<span class="sd">        returns</span>
<span class="sd">        -------</span>
<span class="sd">        tab: Table instance</span>
<span class="sd">            collection of statistics, one column per function in fn and 1 ligne</span>
<span class="sd">            per column in the table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>

        <span class="n">fn</span> <span class="o">=</span> <span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">stats</span><span class="o">.</span><span class="n">std</span><span class="p">,</span>
              <span class="n">stats</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">stats</span><span class="o">.</span><span class="n">max</span><span class="p">,</span>
              <span class="n">stats</span><span class="o">.</span><span class="n">has_nan</span><span class="p">)</span>

        <span class="n">d</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">d</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;FIELD&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">fn</span><span class="p">:</span>
            <span class="n">d</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="p">[])</span>

        <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fill</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fill</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;FIELD&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">fnk</span> <span class="ow">in</span> <span class="n">fn</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">fnk</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">fill</span>
                <span class="n">d</span><span class="p">[</span><span class="n">fnk</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span></div>

    <span class="c1"># method aliases</span>
    <span class="n">remove_column</span> <span class="o">=</span> <span class="n">remove_columns</span>

    <span class="c1"># deprecated methods</span>
    <span class="n">addCol</span> <span class="o">=</span> <span class="n">add_column</span>
    <span class="n">addLine</span> <span class="o">=</span> <span class="n">append_row</span>
    <span class="n">setComment</span> <span class="o">=</span> <span class="n">set_comment</span>
    <span class="n">setUnit</span> <span class="o">=</span> <span class="n">set_unit</span>
    <span class="n">delCol</span> <span class="o">=</span> <span class="n">remove_columns</span></div>


<div class="viewcode-block" id="AstroTable"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.AstroTable">[docs]</a><span class="k">class</span> <span class="nc">AstroTable</span><span class="p">(</span><span class="n">SimpleTable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Derived from the Table, this class add implementations of common astro</span>
<span class="sd">    tools especially conesearch</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ra_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dec_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__autoRADEC__</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">AstroTable</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ra_name</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_ra_name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dec_name</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_dec_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ra_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ra_name&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ra_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dec_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dec_name&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dec_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__autoRADEC__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Tries to identify the columns containing RA and DEC coordinates &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;ra&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">ra_name</span> <span class="o">=</span> <span class="s1">&#39;ra&#39;</span>
        <span class="k">elif</span> <span class="s1">&#39;RA&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">ra_name</span> <span class="o">=</span> <span class="s1">&#39;RA&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ra_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s1">&#39;dec&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">dec_name</span> <span class="o">=</span> <span class="s1">&#39;dec&#39;</span>
        <span class="k">elif</span> <span class="s1">&#39;DEC&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">dec_name</span> <span class="o">=</span> <span class="s1">&#39;DEC&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dec_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">ra_name</span><span class="p">,</span> <span class="n">dec_name</span>

<div class="viewcode-block" id="AstroTable.set_RA"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.AstroTable.set_RA">[docs]</a>    <span class="k">def</span> <span class="nf">set_RA</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the column that defines RA coordinates &quot;&quot;&quot;</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">),</span> <span class="s1">&#39;column name </span><span class="si">{}</span><span class="s1"> not found in the table&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ra_name</span> <span class="o">=</span> <span class="n">val</span></div>

<div class="viewcode-block" id="AstroTable.set_DEC"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.AstroTable.set_DEC">[docs]</a>    <span class="k">def</span> <span class="nf">set_DEC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the column that defines DEC coordinates &quot;&quot;&quot;</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">),</span> <span class="s1">&#39;column name </span><span class="si">{}</span><span class="s1"> not found in the table&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dec_name</span> <span class="o">=</span> <span class="n">val</span></div>

<div class="viewcode-block" id="AstroTable.get_RA"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.AstroTable.get_RA">[docs]</a>    <span class="k">def</span> <span class="nf">get_RA</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns RA, converted from hexa/sexa into degrees &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ra_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">degree</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ra_name</span><span class="p">]</span><span class="o">.</span><span class="n">kind</span> <span class="o">!=</span> <span class="s1">&#39;S&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ra_name</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_ra_name</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">AstroHelpers</span><span class="o">.</span><span class="n">hms2deg</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ra_name</span><span class="p">],</span>
                                                       <span class="n">delim</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_ra_name</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">AstroHelpers</span><span class="o">.</span><span class="n">hms2deg</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ra_name</span><span class="p">],</span>
                                                       <span class="n">delim</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;RA Format not understood&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AstroTable.get_DEC"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.AstroTable.get_DEC">[docs]</a>    <span class="k">def</span> <span class="nf">get_DEC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns RA, converted from hexa/sexa into degrees &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dec_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">degree</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_dec_name</span><span class="p">]</span><span class="o">.</span><span class="n">kind</span> <span class="o">!=</span> <span class="s1">&#39;S&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_dec_name</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_dec_name</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">AstroHelpers</span><span class="o">.</span><span class="n">dms2deg</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_dec_name</span><span class="p">],</span>
                                                       <span class="n">delim</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_dec_name</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">AstroHelpers</span><span class="o">.</span><span class="n">dms2deg</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_dec_name</span><span class="p">],</span>
                                                       <span class="n">delim</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;RA Format not understood&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AstroTable.info"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.AstroTable.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Table: </span><span class="si">{name:s}</span><span class="se">\n</span><span class="s2">       nrows=</span><span class="si">{s.nrows:d}</span><span class="s2">, ncols=</span><span class="si">{s.ncols:d}</span><span class="s2">, mem=</span><span class="si">{size:s}</span><span class="s2">&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NAME&#39;</span><span class="p">,</span> <span class="s1">&#39;Noname&#39;</span><span class="p">),</span> <span class="n">s</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">size</span><span class="o">=</span><span class="n">pretty_size_print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nbytes</span><span class="p">))</span>

        <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">Header:</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">{{0:</span><span class="si">{0:d}</span><span class="s1">s}} {{1}}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

        <span class="n">vals</span> <span class="o">=</span> <span class="p">[(</span><span class="n">k</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_desc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">]</span>
        <span class="n">lengths</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_desc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)))</span>
                   <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colnames</span><span class="p">]</span>
        <span class="n">lengths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">max</span><span class="p">,</span> <span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">lengths</span><span class="p">))))</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ra_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dec_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Position coordinate columns: </span><span class="si">{0}</span><span class="s2">, </span><span class="si">{1}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ra_name</span><span class="p">,</span>
                                                                    <span class="bp">self</span><span class="o">.</span><span class="n">_dec_name</span><span class="p">)</span>

        <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Columns:</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">{{0:</span><span class="si">{0:d}</span><span class="s1">s}} {{1:</span><span class="si">{1:d}</span><span class="s1">s}} {{2:</span><span class="si">{2:d}</span><span class="s1">s}}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">lengths</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_aliases</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Table contains alias(es):&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aliases</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="si">{0:s}</span><span class="s1"> --&gt; </span><span class="si">{1:s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span></div>

<div class="viewcode-block" id="AstroTable.coneSearch"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.AstroTable.coneSearch">[docs]</a>    <span class="k">def</span> <span class="nf">coneSearch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">outtype</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Perform a cone search on a table</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ra0: ndarray[ndim=1, dtype=float]</span>
<span class="sd">            column name to use as RA source in degrees</span>

<span class="sd">        dec0: ndarray[ndim=1, dtype=float]</span>
<span class="sd">            column name to use as DEC source in degrees</span>

<span class="sd">        ra: float</span>
<span class="sd">            ra to look for (in degree)</span>

<span class="sd">        dec: float</span>
<span class="sd">            ra to look for (in degree)</span>

<span class="sd">        r: float</span>
<span class="sd">            distance in degrees</span>

<span class="sd">        outtype: int</span>
<span class="sd">            type of outputs</span>
<span class="sd">                0 -- minimal, indices of matching coordinates</span>
<span class="sd">                1 -- indices and distances of matching coordinates</span>
<span class="sd">                2 -- full, boolean filter and distances</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        t: tuple</span>
<span class="sd">            if outtype is 0:</span>
<span class="sd">                only return indices from ra0, dec0</span>
<span class="sd">            elif outtype is 1:</span>
<span class="sd">                return indices from ra0, dec0 and distances</span>
<span class="sd">            elif outtype is 2:</span>
<span class="sd">                return conditional vector and distance to all ra0, dec0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ra_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dec_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Coordinate columns not set.&#39;</span><span class="p">)</span>

        <span class="n">ra0</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_RA</span><span class="p">()</span>
        <span class="n">dec0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_DEC</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">AstroHelpers</span><span class="o">.</span><span class="n">conesearch</span><span class="p">(</span><span class="n">ra0</span><span class="p">,</span> <span class="n">dec0</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">outtype</span><span class="o">=</span><span class="n">outtype</span><span class="p">)</span></div>

<div class="viewcode-block" id="AstroTable.zoneSearch"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.AstroTable.zoneSearch">[docs]</a>    <span class="k">def</span> <span class="nf">zoneSearch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ramin</span><span class="p">,</span> <span class="n">ramax</span><span class="p">,</span> <span class="n">decmin</span><span class="p">,</span> <span class="n">decmax</span><span class="p">,</span> <span class="n">outtype</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Perform a zone search on a table, i.e., a rectangular selection</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ramin: float</span>
<span class="sd">            minimal value of RA</span>

<span class="sd">        ramax: float</span>
<span class="sd">            maximal value of RA</span>

<span class="sd">        decmin: float</span>
<span class="sd">            minimal value of DEC</span>

<span class="sd">        decmax: float</span>
<span class="sd">            maximal value of DEC</span>

<span class="sd">        outtype: int</span>
<span class="sd">            type of outputs</span>
<span class="sd">                0 or 1 -- minimal, indices of matching coordinates</span>
<span class="sd">                2 -- full, boolean filter and distances</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        r: sequence</span>
<span class="sd">            indices or conditional sequence of matching values</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">assert</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ra_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dec_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="p">),</span> <span class="s1">&#39;Coordinate columns not set.&#39;</span>

        <span class="n">ra0</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_RA</span><span class="p">()</span>
        <span class="n">dec0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_DEC</span><span class="p">()</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="p">(</span><span class="n">ra0</span> <span class="o">&gt;=</span> <span class="n">ramin</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ra0</span> <span class="o">&lt;=</span> <span class="n">ramax</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">dec0</span> <span class="o">&gt;=</span> <span class="n">decmin</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">dec0</span> <span class="o">&lt;=</span> <span class="n">decmax</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">outtype</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ind</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span></div>

<div class="viewcode-block" id="AstroTable.where"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.AstroTable.where">[docs]</a>    <span class="k">def</span> <span class="nf">where</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">condition</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">condvars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cone</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zone</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Read table data fulfilling the given `condition`.</span>
<span class="sd">        Only the rows fulfilling the `condition` are included in the result.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        condition: str</span>
<span class="sd">            expression to evaluate on the table</span>
<span class="sd">            includes mathematical operations and attribute names</span>

<span class="sd">        condvars: dictionary, optional</span>
<span class="sd">            A dictionary that replaces the local operands in current frame.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out: ndarray/ tuple of ndarrays</span>
<span class="sd">        result equivalent to :func:`np.where`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cone</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cone</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Expecting cone keywords as a triplet (ra, dec, r)&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">zone</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Expecting zone keywords as a tuple of 4 elements (ramin, ramax, decmin, decmax)&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">condition</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ind</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">cone</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">zone</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">blobs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cone</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">cone</span>
            <span class="n">_ind</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coneSearch</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">outtype</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">ind</span> <span class="o">&amp;</span> <span class="n">_ind</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
            <span class="n">blobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">zone</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">_ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoneSearch</span><span class="p">(</span><span class="n">zone</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">zone</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">zone</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">zone</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">outtype</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">ind</span> <span class="o">&amp;</span> <span class="n">_ind</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">cone</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">zone</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>  <span class="c1"># cone + zone</span>
            <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">cone</span>
            <span class="n">ind</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coneSearch</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">outtype</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">ind</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoneSearch</span><span class="p">(</span><span class="n">zone</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">zone</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">zone</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">zone</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">outtype</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
            <span class="n">blobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ind</span><span class="p">,</span> <span class="n">blobs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="AstroTable.selectWhere"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.AstroTable.selectWhere">[docs]</a>    <span class="k">def</span> <span class="nf">selectWhere</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">condition</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">condvars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cone</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zone</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Read table data fulfilling the given `condition`.</span>
<span class="sd">            Only the rows fulfilling the `condition` are included in the result.</span>
<span class="sd">            conesearch is also possible through the keyword cone formatted as (ra, dec, r)</span>
<span class="sd">            zonesearch is also possible through the keyword zone formatted as (ramin, ramax, decmin, decmax)</span>

<span class="sd">            Combination of multiple selections is also available.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ind</span><span class="p">,</span> <span class="n">blobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="n">condvars</span><span class="p">,</span> <span class="n">cone</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">tab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">ind</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cone</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tab</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s1">&#39;separation&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">blobs</span><span class="p">),</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;degree&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ra_name</span> <span class="ow">in</span> <span class="n">tab</span><span class="p">:</span>
            <span class="n">tab</span><span class="o">.</span><span class="n">set_RA</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ra_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dec_name</span> <span class="ow">in</span> <span class="n">tab</span><span class="p">:</span>
            <span class="n">tab</span><span class="o">.</span><span class="n">set_DEC</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dec_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">tab</span></div></div>


<div class="viewcode-block" id="stats"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.stats">[docs]</a><span class="k">class</span> <span class="nc">stats</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<div class="viewcode-block" id="stats.has_nan"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.stats.has_nan">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">has_nan</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="kc">True</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">v</span><span class="p">))</span></div>

<div class="viewcode-block" id="stats.mean"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.stats.mean">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></div>

<div class="viewcode-block" id="stats.max"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.stats.max">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">max</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></div>

<div class="viewcode-block" id="stats.min"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.stats.min">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">min</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></div>

<div class="viewcode-block" id="stats.std"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.stats.std">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">std</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></div>

<div class="viewcode-block" id="stats.var"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.stats.var">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">var</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></div>

<div class="viewcode-block" id="stats.p16"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.stats.p16">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">p16</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span></div>

<div class="viewcode-block" id="stats.p84"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.stats.p84">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">p84</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mi">84</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mi">84</span><span class="p">)</span></div>

<div class="viewcode-block" id="stats.p50"><a class="viewcode-back" href="../../pystellibs.html#pystellibs.simpletable.stats.p50">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">p50</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span></div></div>


<span class="c1"># =============================================================================</span>
<span class="c1"># Adding some plotting functions</span>
<span class="c1"># =============================================================================</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pylab</span> <span class="k">as</span> <span class="nn">plt</span>

    <span class="k">def</span> <span class="nf">plot_function</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Generate a plotting method of tab from a given function</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tab: SimpleTable instance</span>
<span class="sd">            table instance</span>

<span class="sd">        fn: str or callable</span>
<span class="sd">            if str, will try a function in matplotlib</span>
<span class="sd">            if callable, calls the function directly</span>

<span class="sd">        xname: str</span>
<span class="sd">            expecting a column name from the table</span>

<span class="sd">        yname: str, optional</span>
<span class="sd">            if provided, another column to use for the plot</span>

<span class="sd">        onlywhere: sequence or str, optional</span>
<span class="sd">            if provided, selects only data with this condition</span>
<span class="sd">            the condition can be a ndarray slice or a string.</span>
<span class="sd">            When a string is given, the evaluation calls :func:`SimpleTable.where`</span>

<span class="sd">        ax: matplotlib.Axes instance</span>
<span class="sd">            if provided make sure it uses the axis to do the plots if a mpl</span>
<span class="sd">            function is used.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        r: object</span>
<span class="sd">            anything returned by the called function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s1">&#39;__call__&#39;</span><span class="p">):</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
            <span class="n">_fn</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;function neither callable or found in matplotlib&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_fn</span> <span class="o">=</span> <span class="n">fn</span>

        <span class="n">onlywhere</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;onlywhere&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">onlywhere</span><span class="p">)</span> <span class="ow">in</span> <span class="n">basestring</span><span class="p">:</span>
            <span class="n">select</span> <span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">onlywhere</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">select</span> <span class="o">=</span> <span class="n">onlywhere</span>

        <span class="n">_args</span> <span class="o">=</span> <span class="p">()</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">)):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">select</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">select</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="n">b</span> <span class="o">=</span> <span class="nb">list</span><span class="p">((</span><span class="n">b</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">b</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">))</span>
                    <span class="n">_args</span> <span class="o">+=</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="n">_args</span> <span class="o">+=</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_args</span> <span class="o">+=</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">_fn</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">attached_function</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">errorlevel</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; eclare a function as a method to the class table&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">_fn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">plot_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">errorlevel</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">e</span>

        <span class="k">if</span> <span class="n">doc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_fn</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">doc</span>

        <span class="k">return</span> <span class="n">_fn</span>

    <span class="n">SimpleTable</span><span class="o">.</span><span class="n">plot_function</span> <span class="o">=</span> <span class="n">plot_function</span>
    <span class="n">SimpleTable</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="n">attached_function</span><span class="p">(</span><span class="s1">&#39;plot&#39;</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="n">SimpleTable</span><span class="o">.</span><span class="n">hist</span> <span class="o">=</span> <span class="n">attached_function</span><span class="p">(</span><span class="s1">&#39;hist&#39;</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="n">SimpleTable</span><span class="o">.</span><span class="n">hist2d</span> <span class="o">=</span> <span class="n">attached_function</span><span class="p">(</span><span class="s1">&#39;hist2d&#39;</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist2d</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="n">SimpleTable</span><span class="o">.</span><span class="n">hexbin</span> <span class="o">=</span> <span class="n">attached_function</span><span class="p">(</span><span class="s1">&#39;hexbin&#39;</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">hexbin</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="n">SimpleTable</span><span class="o">.</span><span class="n">scatter</span> <span class="o">=</span> <span class="n">attached_function</span><span class="p">(</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>

    <span class="c1"># newer version of matplotlib</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">plt</span><span class="p">,</span> <span class="s1">&#39;violinplot&#39;</span><span class="p">):</span>
        <span class="n">SimpleTable</span><span class="o">.</span><span class="n">violinplot</span> <span class="o">=</span> <span class="n">attached_function</span><span class="p">(</span><span class="s1">&#39;violinplot&#39;</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">violinplot</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">plt</span><span class="p">,</span> <span class="s1">&#39;boxplot&#39;</span><span class="p">):</span>
        <span class="n">SimpleTable</span><span class="o">.</span><span class="n">boxplot</span> <span class="o">=</span> <span class="n">attached_function</span><span class="p">(</span><span class="s1">&#39;boxplot&#39;</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">boxplot</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>

<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, M. Fouesneau.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    
    <a href="https://github.com/mfouesneau/pystellibs" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>